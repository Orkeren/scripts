%%
%% This is file `songs.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% songs.dtx  (with options: `package')
%% 
%% This is a generated file.
%% 
%% Copyright (C) 2005 by Kevin W. Hamlen
%% 
%% This file may be distributed and/or modified under the conditions of
%% the LaTeX Project Public License, either version 1.3a of this license
%% or (at your option) any later version.  The latest version of this
%% license is in:
%% 
%%    http://www.latex-project.org/lppl.txt
%% 
%% and version 1.3a or later is part of all distributions of LaTeX version
%% 2004/10/01 or later.
%% 
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{songs}
  [2007/06/18 v2.0 Songs package]
\newif\ifSB@pdf\SB@pdffalse
\ifx\pdfoutput\undefined\else
  \ifx\pdfoutput\relax\else
    \ifnum\pdfoutput<1 \else
      \SB@pdftrue
    \fi
  \fi
\fi
\newif\ifSB@preamble
\SB@preambletrue
\newdimen\SB@dimen
\newdimen\SB@dimenii
\newdimen\SB@dimeniii
\newbox\SB@box
\newbox\SB@boxii
\newtoks\SB@toks
\newcount\SB@cnt
\newif\ifSB@test
\newcommand\SB@temp{}
\newcommand\SB@Error[2]{\PackageError{songs}{#1}{#2}}
\RequirePackage{keyval}
\newcommand\SB@outer{\outer}
\DeclareOption{unouter}{\renewcommand\SB@outer{}}
\newif\ifrawtext\rawtextfalse
\DeclareOption{rawtext}{\rawtexttrue\indexesoff}
\newif\ifoverhead\overheadfalse
\DeclareOption{overheads}{%
  \overheadtrue%
  \SB@omitscriptrue%
  \SB@showindexesfalse\songindexesfalse%
  \SB@singlecoltrue%
  \ifSB@chordsreq\else\SB@chordsoff\fi%
}
\newif\ifpdfindex\pdfindextrue
\DeclareOption{nopdfindex}{\pdfindexfalse}
\newif\ifSB@colorboxes\SB@colorboxestrue
\DeclareOption{noshading}{\SB@colorboxesfalse}
\newif\ifSB@genindexes\SB@genindexestrue
\newif\ifSB@showindexes\SB@showindexestrue
\newif\ifsongindexes\songindexestrue
\DeclareOption{noindexes}{\indexesoff}
\newcommand\indexeson{%
  \ifSB@preamble%
    \SB@genindexestrue%
  \else%
    \ifSB@genindexes\else%
      \PackageWarning{songs}{Indexes shown but index-generation\space%
      inhibited. Index files may be out of date.}{Indexes were\space%
      initially turned off by the end of the document preamble,\space%
      which means that the auxilliary files used to keep the\space%
      indexes uptodate were not generated. However, indexes were\space%
      turned on within the document body using \protect\indexeson%
      \space, which means the indexes shown in the resulting\space%
      document are being created from outdated files. To\space%
      correct the problem, be sure that indexes are turned on by\space%
      the end of the preamble so that the auxilliary files will\space%
      be updated.}%
    \fi%
  \fi%
  \SB@showindexestrue\songindexestrue%
}
\newcommand\indexesoff{%
  \ifSB@preamble\SB@genindexesfalse\fi%
  \SB@showindexesfalse\songindexesfalse%
}
\newif\ifmeasures
\newif\ifSB@measuresreq\SB@measuresreqfalse
\newcommand\SB@mbar[2]{}
\newcommand\mch[4]{}
\newcommand\SB@measureson{%
  \measurestrue%
  \renewcommand\SB@mbar[2]{\SB@makembar{##1}{##2}}%
  \ifchorded%
    \let\mch\SB@mch%
  \else%
    \renewcommand\mch[4]{##2\measurebar##3}%
  \fi%
}
\newcommand\SB@measuresoff{%
  \measuresfalse%
  \renewcommand\SB@mbar[2]{}%
  \let\mch\ch%
}
\newcommand\measureson{\SB@measuresreqtrue\SB@measureson}
\newcommand\measuresoff{\SB@measuresreqtrue\SB@measuresoff}
\DeclareOption{showmeasures}{\measureson}
\DeclareOption{nomeasures}{\measuresoff}
\newif\iftransposecapos\transposecaposfalse
\DeclareOption{transposecapos}{\transposecapostrue}
\newif\ifchorded
\newif\ifSB@chordsreq\SB@chordsreqfalse
\newcommand\ch[4]{}
\newcommand\SB@bracket[1]{}
\newcommand\SB@setbaselineskip{}
\newcommand\SB@chordson{%
  \ifrawtext%
    \SB@Error{Cannot display chords in a rawtext dump}%
    {You have used the rawtext option in the \protect\usepackage%
    \space line and have either used the chorded option as well%
    \space or have used the \protect\chordson macro subsequently.}%
  \else%
    \chordedtrue%
    \renewcommand\SB@bracket[1]{\SB@chord{##1}}%
    \renewcommand\ch[4]{\[\SB@noreplay{\hphantom{##2}}##1]##4}
    \ifSB@measuresreq%
      \ifmeasures%
        \SB@measureson%
      \else%
        \SB@measuresoff%
      \fi%
    \else%
      \SB@measureson%
    \fi%
    \SB@setbaselineskip%
  \fi%
}
\newcommand\SB@chordsoff{%
  \chordedfalse%
  \renewcommand\SB@bracket[1]{\ignorespaces}%
  \renewcommand\ch[4]{##4}%
  \ifSB@measuresreq%
    \ifmeasures%
      \SB@measureson%
    \else%
      \SB@measuresoff%
    \fi%
  \else%
    \SB@measuresoff%
  \fi%
  \SB@setbaselineskip%
}
\newcommand\chordson{\SB@chordsreqtrue\SB@chordson}
\newcommand\chordsoff{\SB@chordsreqtrue\SB@chordsoff}
\DeclareOption{chorded}{\chordson}
\DeclareOption{lyric}{\chordsoff}
\newif\ifSB@omitscrip\SB@omitscripfalse
\DeclareOption{noscripture}{\SB@omitscriptrue}
\newcommand\scriptureon{\SB@omitscripfalse}
\newcommand\scriptureoff{\SB@omitscriptrue}
\newif\ifSB@singlecol\SB@singlecolfalse
\DeclareOption{twosongcolumns}{\SB@singlecolfalse}
\DeclareOption{onesongcolumn}{\SB@singlecoltrue}
\newcommand\SB@singlecolon{%
  \SB@singlecoltrue%
  \SB@colwidth\textwidth%
}
\newcommand\onesongcolumn{%
  \ifSB@singlecol\else%
    \ifSB@preamble\else%
      \SB@ejectpage%
    \fi%
    \SB@singlecolon%
  \fi}
\newcommand\SB@singlecoloff{%
  \SB@singlecolfalse%
  \SB@colwidth\textwidth%
  \advance\SB@colwidth-\columnsep%
  \divide\SB@colwidth\tw@%
}
\newcommand\twosongcolumns{%
  \ifoverhead%
    \SB@Error{Two-column overheads are not possible}%
    {You have used the overheads option in the \protect\usepackage%
    \space line, which demands single-column output, but then used%
    \space the \protect\twosongcolumns\space macro to shift to%
    \space two-column mode.}%
  \else%
    \ifSB@singlecol%
      \ifSB@preamble\else%
        \SB@ejectpage%
      \fi%
      \SB@singlecoloff%
    \fi%
  \fi%
}
\newcommand\SB@mch[4]{#2\measurebar\[#1]#3}
\SB@chordson
\ExecuteOptions{twocolumn}
\ProcessOptions\relax
\ifSB@pdf\else\pdfindexfalse\fi
\ifSB@colorboxes
  \RequirePackage{color}
  \definecolor{SongbookShade}{gray}{.80}
  \newcommand\SB@colorbox[1]{\colorbox{SongbookShade}{#1}}
\else
  \newcommand\SB@colorbox[1]{\vbox{%
    \kern3pt%
    \hbox{\kern3pt{#1}\kern3pt}%
    \kern3pt%
  }}
\fi
\newif\ifpartiallist\partiallistfalse
\newcommand\songlist{}
\newcommand\includeonlysongs[1]{%
  \partiallisttrue%
  \renewcommand\songlist{#1}%
}
\@onlypreamble\includeonlysongs
\newcommand\scripturefont{%
  \usefont{OT1}{pzc}{mb}{it}%
  \shiftdblquotes{-1.1pt}{0pt}{-2pt}{0pt}%
}
\newcommand\printscrcite[1]{{\sffamily\small#1}}
\ifoverhead
  \newcommand\lyricfont{\normalfont\huge}
\else
  \newcommand\lyricfont{\normalfont\normalsize}
\fi
\newcommand\songnumstyle[1]{\arabic{#1}}
\newcommand\versenumstyle[1]{\arabic{#1}}
\newcommand\printsongnum[1]{\sffamily\bfseries\LARGE#1}
\newcommand\printversenum[1]{\lyricfont#1.\ }
\newcommand\printchord[1]{\sffamily\slshape\large#1}
\newskip\versesep
\ifoverhead
  \versesep 15pt\@plus3pt\relax
\else
  \ifchorded
    \versesep 15pt\@plus3pt\relax
  \else
    \versesep 6pt\@plus3pt\relax
  \fi
\fi
\parindent0.25in
\newlength\idxheadwidth
\setlength\idxheadwidth{1.5cm}
\newlength\songnumwidth
\settowidth\songnumwidth{\printsongnum{999.}}
\newlength\versenumwidth
\settowidth\versenumwidth{\printversenum{9\kern1em}}
\newcommand\noversenumbers{%
  \renewcommand\printversenum[1]{}%
  \setlength\versenumwidth{0pt}%
}
\newdimen\SB@colwidth
\newlength\SB@chorusindent
\ifoverhead
  \setlength\SB@chorusindent{10pt}
\else
  \setlength\SB@chorusindent{5pt}
\fi
\AtBeginDocument{
  \ifpartiallist
    \SB@genindexesfalse\SB@showindexesfalse\songindexesfalse
  \fi
  \ifchorded
    \SB@maxcoldiff0.8in
  \else
    \SB@maxcoldiff2in
  \fi
  \ifdim\colminheight=123456789sp
    \ifchorded
      \setlength{\colminheight}{0pt}
    \else\ifoverhead
      \setlength{\colminheight}{0pt}
    \else
      \setlength{\colminheight}{\textheight}
    \fi\fi
  \fi
  \ifSB@singlecol\SB@singlecolon\else\SB@singlecoloff\fi
  \SB@preamblefalse
}
\newbox\SB@songbox
\newbox\SB@colLbox
\newbox\SB@colRbox
\newdimen\SB@maxcoldiff
\newlength\colminheight
\setlength\colminheight{123456789sp}
\newcount\SB@colnmbr
\SB@colnmbr0
\newdimen\SB@clenremaining
\newcommand\SB@firstmark{}
\newcommand\SB@splitendmark{SB@splitendmark}
\newcommand\SB@mockvsplit[1]{%
  \begingroup%
    \setbox\SB@box\vbox{%
      \unvcopy#1%
      \mark{\SB@splitendmark}%
      \vfil%
    }%
    \setbox\SB@box%
      \vsplit\SB@box to\maxdimen%
    \global\long\edef\SB@firstmark{\splitfirstmark}%
  \endgroup%
}
\newcommand\SB@maxmin[3]{\ifdim#1#2#3#1#3\fi}
\newcommand\SB@emitpage{%
  \unvbox\voidb@x%
  \addtolength\textheight{-\pagetotal}%
  \SB@dimeniii\colminheight%
  \advance\SB@dimeniii-\pagetotal%
  \SB@maxmin\SB@dimeniii<\z@%
  \SB@maxmin\SB@dimeniii<{\ht\SB@colLbox}%
  \SB@maxmin\SB@dimeniii<{\ht\SB@colRbox}%
  \SB@maxmin\SB@dimeniii>\textheight%
  \SB@dimen\SB@dimeniii%
  \SB@dimenii\SB@dimeniii%
  \advance\SB@dimeniii-\SB@maxcoldiff%
  \ifdim\ht\SB@colLbox<\SB@dimeniii\SB@dimen\ht\SB@colLbox\fi%
  \ifdim\ht\SB@colRbox<\SB@dimeniii\SB@dimenii\ht\SB@colRbox\fi%
  \advance\SB@dimeniii2\SB@maxcoldiff%
  \ifdim\ht\SB@colLbox>\SB@dimeniii\SB@dimen\ht\SB@colLbox\fi%
  \ifdim\ht\SB@colRbox>\SB@dimeniii\SB@dimenii\ht\SB@colRbox\fi%
  \SB@maxmin\SB@dimen>\textheight%
  \SB@maxmin\SB@dimenii>\textheight%
  \addtolength\textheight\pagetotal%
  \ifSB@singlecol%
    \hbox{\vbox to\SB@dimen{\unvbox\SB@colLbox\kern\z@}}%
  \else%
    \hbox{%
      \vtop to\SB@dimen{\kern\z@\unvbox\SB@colLbox}%
      \hskip\columnsep%
      \vtop to\SB@dimenii{\kern\z@\unvbox\SB@colRbox}%
    }%
    \nointerlineskip%
    \null%
  \fi%
  \vfil\break%
}
\newcommand\SB@appendtocolumn[1]{%
  \ifodd\SB@colnmbr%
    \global\let\SB@thiscolbox\SB@colRbox%
  \else%
    \global\let\SB@thiscolbox\SB@colLbox%
  \fi%
  \global\setbox\SB@thiscolbox\vbox{\unvbox\SB@thiscolbox\unvbox#1}%
}
\newcommand\SB@ejectpage{%
  \ifvoid\SB@colLbox%
    \ifvoid\SB@colRbox\else\SB@emitpage\fi%
  \else%
    \SB@emitpage%
  \fi%
  \ifdim\pagetotal>\z@%
    \vskip\z@skip%
    \nointerlineskip%
    \null%
    \nointerlineskip%
  \fi%
  \global\SB@colnmbr0 %
  \global\SB@clenremaining\textheight%
  \global\advance\SB@clenremaining-\pagetotal%
}
\newcommand\SB@nextcol{%
  \ifSB@singlecol%
    \SB@ejectpage%
  \else%
    \ifodd\SB@colnmbr\SB@emitpage\fi%
    \global\SB@clenremaining\textheight%
    \global\advance\SB@clenremaining-\pagetotal%
    \global\advance\SB@colnmbr\@ne%
  \fi%
}
\newcommand\SB@ifwillfit[4]{%
  \global\setbox\SB@box\copy\SB@songbox%
  {%
    \vbadness\@M\vfuzz\maxdimen\splitmaxdepth\z@%
    \global\setbox\SB@boxii\vsplit\SB@box to#1%
    \ifnum\badness>0 %
      \global\setbox\SB@box\copy\SB@songbox%
    \fi%
    \ifdim\ht\SB@box>\z@%
      \global\setbox\SB@boxii\vsplit\SB@box to#2%
    \fi%
  }%
  \ifdim\ht\SB@box=\z@#3\else#4\fi%
}
\newcommand\SB@selectcol{%
  \ifSB@singlecol%
    \ifdim\ht\SB@songbox>\SB@clenremaining%
      \ifdim\ht\SB@songbox>\textheight\else%
        \SB@nextcol%
      \fi%
    \fi%
  \else%
    \ifdim\ht\SB@songbox>\SB@clenremaining%
      \SB@dimen\textheight%
      \ifodd\SB@colnmbr\else%
        \advance\SB@dimen-\pagetotal%
      \fi%
      \ifdim\ht\SB@songbox>\SB@dimen%
        \SB@ifwillfit\textheight\textheight{%
          \ifodd\SB@colnmbr%
            \SB@nextcol%
          \else%
            \SB@ifwillfit\SB@clenremaining\SB@dimen{}{%
              \SB@nextcol\SB@nextcol%
            }%
          \fi%
        }{%
          \ifodd\count0 %
            \SB@ejectpage%
          \fi%
        }%
      \else%
        \SB@nextcol%
      \fi%
    \fi%
  \fi%
}
\newcommand\SB@dosubmitsong{%
  \ifdim\ht\SB@songbox>\SB@clenremaining%
    \global\setbox\SB@box\copy\SB@songbox%
    {%
      \vbadness\@M\vfuzz\maxdimen\splitmaxdepth\z@%
      \global\setbox\SB@box%
        \vsplit\SB@box to\SB@clenremaining%
    }%
    \ifnum\badness>\vbadness%
      \SB@nextcol%
    \fi%
  \fi%
  \SB@selectcol%
  \SB@mockvsplit\SB@songbox%
  \ifx\SB@firstmark\SB@splitendmark\else%
    \mark{\SB@firstmark}%
  \fi%
  \ifdim\ht\SB@songbox>\SB@clenremaining%
    \loop%
      {%
        \splitmaxdepth\z@%
        \global\setbox\SB@box%
          \vsplit\SB@songbox to\SB@clenremaining%
      }%
      \SB@appendtocolumn\SB@box%
      \SB@nextcol%
    \ifdim\ht\SB@songbox>\SB@clenremaining\repeat%
  \fi%
  \global\advance\SB@clenremaining-\ht\SB@songbox%
  \SB@appendtocolumn\SB@songbox%
  \ifoverhead\SB@nextcol\fi%
}
\newcommand\SB@thisid{}
\newcommand\SB@submitsong{%
  \ifSB@songsenv%
    \ifpartiallist%
      \edef\SB@thisid{\songnumstyle{songnum}}%
      \@for\SB@temp:=\songlist\do{%
        \ifx\SB@temp\SB@thisid%
          \expandafter\newbox\csname songbox@\SB@temp\endcsname%
          \global\expandafter\setbox\csname songbox@\SB@temp\endcsname%
          \box\SB@songbox%
        \fi%
      }%
    \else%
      \SB@dosubmitsong%
    \fi%
  \else%
    \unvbox\SB@songbox%
  \fi%
}
\newcommand\SB@finalizesonglist{%
  \ifpartiallist%
    \@for\SB@temp:=\songlist\do{%
      \expandafter\ifx\csname songbox@\SB@temp\endcsname\relax\else%
        \setbox\SB@songbox%
          \expandafter\box\csname songbox@\SB@temp\endcsname%
        \SB@dosubmitsong%
      \fi%
    }%
  \fi%
}
\newcommand\nextcol{\ifpartiallist\else\SB@nextcol\fi}
\newcounter{songnum}
\newcounter{versenum}
\newcommand\SB@lop[1]{\expandafter\SB@@lop\the#1\SB@@lop#1}
\newcommand\SB@@lop{}
\def\SB@@lop\\#1\\#2\SB@@lop#3#4{\global#4{#1}\global#3{\\#2}}
\newcommand\SB@emptylist{}
\def\SB@emptylist{\\}
\newcommand\SB@ifempty[3]{%
  \edef\SB@temp{\the#1}%
  \ifx\SB@temp\SB@emptylist#2\else#3\fi%
}
\newtoks\SB@titlelist
\newtoks\SB@titletail
\newcommand\songtitle{}
\newtoks\songtitletoks
\newcommand\resettitles{%
  \global\SB@titletail\SB@titlelist%
  \nexttitle%
}
\newcommand\nexttitle{%
  \SB@ifempty\SB@titletail{%
    \global\songtitletoks{\relax}%
    \global\let\songtitle\relax%
  }{%
    \SB@lop\SB@titletail\songtitletoks%
    \edef\songtitle{\the\songtitletoks}%
  }%
}
\newcommand\foreachtitle[1]{%
  \ifx\songtitle\relax\else%
    \loop#1\nexttitle\ifx\songtitle\relax\else\repeat%
  \fi%
}
\newif\ifSB@songsenv\SB@songsenvfalse
\newif\ifSB@insong\SB@insongfalse
\newif\ifSB@inscripture\SB@inscripturefalse
\newif\ifSB@inverse\SB@inversefalse
\newif\ifSB@inchorus\SB@inchorusfalse
\newcommand\songrefs{}
\newcommand\songauthors{}
\newcommand\songcopyright{}
\newcommand\songlicense{}
\newtoks\SB@refstoks
\newtoks\SB@authtoks
\newcommand\SB@prevsong{0}
\newcommand\setlicense[1]{\gdef\songlicense{#1}}
\newtoks\SB@clearbskeys
\newcommand\newsongkey[2]{%
  \SB@clearbskeys\expandafter{\the\SB@clearbskeys#2}%
  \define@key{beginsong}{#1}%
}
\newsongkey{sr}
           {\def\songrefs{}\SB@refstoks{}}
           {\def\songrefs{\SB@parsesrefs{#1}}\SB@refstoks{#1}}
\newsongkey{by}
           {\def\songauthors{}\SB@authtoks{}}
           {\def\songauthors{#1}\SB@authtoks{#1}}
\newsongkey{cr}{\def\songcopyright{}}{\def\songcopyright{#1}}
\newsongkey{lic}{\def\songlicense{}}{\def\songlicense{#1}}
\newcommand\SB@beginsong[1]{%
  \ifSB@insong%
    \SB@Error{Encountered \protect\beginsong\space%
    without seeing an \protect\endsong for the previous song}%
    {Song \songnumstyle{songnum} might be missing an \protect\end%
    song line.}%
    \SB@endsong%
  \fi%
  \ifSB@inscripture%
    \SB@Error{Encountered \protect\beginsong\space%
    without seeing an \protect\endscripture for the preceeding\space%
    scripture quotation}{A scripture quotation appearing after\space%
    song \songnumstyle{songnum} might be missing an \protect\end%
    scripture line.}%
    \SB@endscripture%
  \fi%
  \SB@insongtrue%
  \the\SB@clearbskeys%
  \SB@titlelist{\\#1\\}%
  \@ifnextchar[\SB@bskvfmt\SB@@beginsong%
}
\newcommand\SB@@beginsong{%
  \@ifnextchar\bgroup\SB@bsoldfmt\SB@@@beginsong%
}
\newcommand\SB@bsoldfmt[3]{%
  \SB@bskvfmt[sr={#1},by={#2},cr={#3}]%
}
\newcommand\SB@bskvfmt{}
\def\SB@bskvfmt[#1]{%
  \setkeys{beginsong}{#1}%
  \SB@@@beginsong%
}
\newcommand\SB@@@beginsong{%
  \resettitles%
  \SB@addtoindexes\songtitletoks\SB@refstoks\SB@authtoks%
  \nexttitle%
  \foreachtitle{\SB@addtotitles\songtitletoks}%
  \resettitles%
  \setbox\SB@songbox\vbox\bgroup%
    \hsize\SB@colwidth%
    \leftskip\z@skip\rightskip\z@skip%
    \parfillskip\z@\@plus1fil\parskip\z@skip%
    \global\SB@transposefactor0 %
    \global\SB@chist{\\}%
    \lyricfont%
    \SB@setbaselineskip%
    \SB@raggedright%
    \setcounter{versenum}{1}%
    \SB@meter{4}{4}%
}
\newcommand\SB@endsong{%
  \ifSB@insong%
    \ifSB@inverse%
      \SB@Error{Encountered \protect\endsong\space%
      without seeing an \protect\endverse for the preceding verse}%
      {Song \songnumstyle{songnum} has a \protect\beginverse\space%
      line with no matching \protect\endverse line.}%
      \SB@endverse%
    \fi%
    \ifSB@inchorus%
      \SB@Error{Encountered \protect\endsong\space%
      without seeing an \protect\endchorus for the preceding chorus}%
      {Song \songnumstyle{songnum} has a \protect\beginchorus\space%
      line with no matching \protect\endchorus line.}%
      \SB@endchorus%
    \fi%
    \egroup%
    \setbox\SB@songbox\vbox{%
      \songmark%
      \hsize\SB@colwidth%
      \leftskip\z@skip\rightskip\z@skip%
      \parfillskip\z@\@plus1fil\parskip\z@skip\parindent\z@%
      \ifoverhead\else%
        \hrule\@height\p@\@width\SB@colwidth%
        \nobreak\vskip5pt%
      \fi%
      \ifpdfindex\begingroup%
        \@ifundefined{pdfbookmark}{}{%
          \resettitles%
          \pdfbookmark[\ifnum\arabic{section}=0 1\else2\fi]%
            {\songnumstyle{songnum}. \songtitle}%
            {song\arabic{SB@songsnum}-\songnumstyle{songnum}}%
        }%
      \endgroup\fi%
      \vbox{\makeprelude}%
      \nobreak\vskip\versesep%
      \vskip2pt\@plus4pt%
      \unvbox\SB@songbox%
      \unskip\nobreak\vskip\versesep%
      \vskip2pt\@plus4pt%
      \nointerlineskip%
      \vbox{\makepostlude}%
      \ifoverhead%
        \nobreak\vskip\z@\relax%
      \else%
        \nobreak\vskip2pt\@plus\p@%
        \hrule\@height\p@\@width\SB@colwidth%
        \vskip-\p@\relax%
      \fi%
    }%
    \SB@insongfalse%
    \SB@submitsong%
    \SB@stanzanum0 %
    \edef\SB@prevsong{\songnumstyle{songnum}}%
    \stepcounter{songnum}%
  \else%
    \ifSB@inscripture%
      \SB@Error{Encountered \protect\endsong\space%
      without seeing an \protect\endscripture for the preceding\space%
      scripture quote}{A scripture quote appearing after song\space%
      \SB@prevsong\space ended with \protect\endsong instead of\space%
      with \protect\endscripture.}%
      \SB@endscripture%
    \else%
      \SB@Error{Encountered \protect\endsong with\space%
      no matching \protect\beginsong}{After song \SB@prevsong\space%
      there was an \protect\endsong with no matching \protect\begin%
      song.}%
    \fi%
  \fi%
}
\newcommand\songmark{}
\renewcommand\SB@setbaselineskip{%
  \ifSB@insong%
    \ifchorded%
      \settoheight\baselineskip{\vbox{%
        \hbox{\printchord{ABCDEFG\shrp\flt/j7}}%
        \hbox{\lyricfont/}
      }}%
    \else%
      \baselineskip\f@size pt\relax%
    \fi%
    \advance\baselineskip\z@\@plus\p@\relax%
  \fi%
}
\newbox\SB@songnumbox
\newbox\SB@songheader
\newcommand\makeprelude{%
  \resettitles%
  \ifoverhead%
    \hbox to\hsize{%
      \hfil\sffamily\Huge\ignorespaces\songtitle\unskip\hfil%
    }%
    \vskip5pt%
    \hbox to\hsize{%
      \hfil%
      \vbox{%
        \divide\hsize\tw@%
        \leftskip\z@\@plus1fil\relax\rightskip\z@\@plus1fil\relax%
        \parskip\p@\relax\parfillskip\z@skip\small%
        \extendprelude%
      }%
      \hfil%
    }%
  \else%
    \setbox\SB@songnumbox\hbox{\SB@colorbox{%
      \hbox to\songnumwidth{%
        \printsongnum{\songnumstyle{songnum}}\hfil%
      }%
    }}%
    \setbox\SB@songheader\vbox{%
      \hsize\SB@colwidth%
      \advance\hsize-\wd\SB@songnumbox%
      \advance\hsize-3pt%
      \SB@raggedright\offinterlineskip\lineskip\p@%
      {\sffamily\slshape\Large%
        \ignorespaces\songtitle\par%
        \nexttitle%
        \foreachtitle{(\ignorespaces\songtitle\unskip)\par}%
      }%
      \ifdim\prevdepth=\z@\kern\p@\fi%
      \parskip\p@\relax\tiny%
      \extendprelude%
      \kern0pt%
    }%
    \hbox{%
      \ifdim\ht\SB@songnumbox>\ht\SB@songheader%
        \box\SB@songnumbox%
        \kern3pt%
        \vtop{\box\SB@songheader}%
      \else%
        \SB@colorbox{\vbox to\ht\SB@songheader{%
          \hbox to\songnumwidth{%
            \printsongnum{\songnumstyle{songnum}}\hfil%
          }\vfil%
        }}%
        \kern3pt%
        \box\SB@songheader%
      \fi%
    }%
  \fi%
}
\newcommand\makepostlude{%
  \SB@raggedright\baselineskip\z@skip\parskip\z@skip\parindent\z@%
  \tiny\extendpostlude%
}
\newcommand\showauthors{%
  \setbox\SB@box\hbox{\bfseries\sfcode`.\@m\songauthors}%
  \ifdim\wd\SB@box>\z@\unhbox\SB@box\par\fi%
}
\newcommand\showrefs{%
  \setbox\SB@box\hbox{\slshape\songrefs\vphantom,}%
  \ifdim\wd\SB@box>\z@\unhbox\SB@box\par\fi%
}
\newcommand\extendprelude{\showrefs\showauthors}
\newcommand\extendpostlude{\songcopyright\ \songlicense\unskip}
\newcommand\SB@parsesrefs[1]{{%
  \let\SB@walkone\relax%
  \let\SB@walktwo\relax%
  \afterassignment\SB@walkscan%
  \let\SB@walkthree= #1\SB@walkend\relax\relax%
}}
\newcommand\SB@walkscan{%
  \futurelet\SB@walkfour\SB@walkstep%
}
\newcommand\SB@walkend{Mark token list ending for SB@parsesrefs}
\newcommand\SB@testdigit[1]{%
  \SB@testfalse%
  \ifx0#1\SB@testtrue\fi%
  \ifx1#1\SB@testtrue\fi%
  \ifx2#1\SB@testtrue\fi%
  \ifx3#1\SB@testtrue\fi%
  \ifx4#1\SB@testtrue\fi%
  \ifx5#1\SB@testtrue\fi%
  \ifx6#1\SB@testtrue\fi%
  \ifx7#1\SB@testtrue\fi%
  \ifx8#1\SB@testtrue\fi%
  \ifx9#1\SB@testtrue\fi%
}
\newcommand\SB@walkstep{%
  \ifcat\noexpand\SB@walktwo\noexpand\@sptoken%
    \ifcat\noexpand\SB@walkthree A%
      \ifcat\noexpand\SB@walkone A~\else%
        \ifx;\noexpand\SB@walkone%
          \penalty-5\hskip0.5em\relax%
        \else%
          \SB@testdigit\SB@walkone%
          \ifSB@test~\else\SB@walktwo\fi%
        \fi%
      \fi%
    \else\ifcat\noexpand\SB@walkone A%
      \SB@testdigit\SB@walkthree%
      \ifSB@test~\else\SB@walktwo\fi%
    \else\ifx\SB@walkone;%
      \ifcat\noexpand\SB@walkfour\noexpand\@sptoken%
        \SB@testdigit\SB@walkthree%
        \ifSB@test\penalty-5\hskip0.5em\relax\else\SB@walktwo\fi%
      \else%
        \SB@walktwo%
      \fi%
    \else%
      \SB@walktwo%
    \fi\fi\fi%
  \else\ifx\SB@walktwo-%
    \ifx\SB@walkone-\SB@walktwo\else%
      \ifx\SB@walkthree-\SB@walktwo\else--\fi%
    \fi%
  \else\ifx\SB@walkone,%
    \SB@testdigit\SB@walktwo%
    \ifSB@test\nobreak\thinspace\fi%
    \SB@walktwo%
  \else%
    \SB@walktwo%
  \fi\fi\fi%
  \let\SB@walkone= \SB@walktwo%
  \let\SB@walktwo= \SB@walkthree%
  \ifx\SB@walkthree\SB@walkend\else%
    \afterassignment\SB@walkscan%
  \fi%
  \let\SB@walkthree= %
}
\newcommand\brk{\penalty-5\relax}
\newcommand\rep[1]{%
  (\raise0.25ex\hbox{%
    \fontencoding{OMS}\fontfamily{cmsy}\selectfont\char2%
   }#1)%
}
\newcount\SB@stanzanum
\newcommand\SB@stanzabreak{%
  \ifhmode\par\fi%
  \advance\SB@stanzanum\@ne%
  \ifnum\SB@stanzanum>\@ne%
    \SB@lastskip\lastskip%
    \unskip\vfil\penalty-100 \vfilneg%
    \SB@ifskipzero\SB@lastskip{}{\vskip\SB@lastskip}%
  \fi%
}
\newcommand\SB@obeylines{}
{
  \catcode`\^^M\active%
  \gdef\SB@obeylines{%
    \catcode`\^^M\active%
    \let^^M\SB@outerpar%
  }%
}
\newcount\SB@EOLcat
\newcommand\SB@tempobeylines{}
{
  \catcode`\^^M\active%
  \gdef\SB@tempobeylines{%
    \begingroup%
    \catcode`\^^M\active%
    \SB@outer\def^^M{\par\endgroup}%
  }%
}
\newdimen\SB@parindent
\newcommand\SB@raggedright{%
  \SB@parindent\parindent%
  \raggedright%
  \parindent\SB@parindent%
}
\newif\ifSB@vnum
\newcommand\SB@beginverse{%
  \ifSB@insong%
    \ifSB@inverse%
      \SB@Error{Encountered \protect\beginverse\space%
      without seeing an \protect\endverse for the preceding verse}%
      {Song \songnumstyle{songnum} might have a verse that has\space%
      no \protect\endendverse line.}%
      \SB@endverse%
    \fi%
    \ifSB@inchorus%
      \SB@Error{Encountered \protect\beginverse\space%
      without seeing an \protect\endchorus for the preceding chorus}%
      {Song \songnumstyle{songnum} might have a chorus that has\space%
      no \protect\endchorus line.}%
      \SB@endchorus%
    \fi%
  \else%
    \SB@Error{Encountered \protect\beginverse\space%
    without first seeing a \protect\beginsong line}{After song\space%
    \SB@prevsong, there is a \protect\beginverse line not\space%
    contained in any song.}%
    \SB@beginsong{Unknown Song}%
  \fi%
  \SB@inversetrue%
  \SB@stanzabreak%
  \begingroup%
    \ifoverhead%
      \leftskip\z@\@plus1fil%
      \advance\leftskip\versenumwidth%
      \rightskip\leftskip%
      \parfillskip\z@skip%
      \parindent\z@%
    \else%
      \leftskip\parindent%
      \advance\leftskip\versenumwidth%
      \parindent-\parindent%
    \fi%
    \everypar{%
      \hskip\ifoverhead-\leftskip\else-\versenumwidth\fi%
      \setbox\SB@box\hbox{%
        \printversenum{\versenumstyle{versenum}}%
      }%
      \ifdim\wd\SB@box<\versenumwidth%
        \hbox to\versenumwidth{\unhbox\SB@box\hfil}%
      \else%
        \box\SB@box%
      \fi%
      \ifoverhead\hfil\fi%
      \everypar{}%
    }%
    \SB@loadaccidentals%
    \SB@ifempty\SB@chist{\SB@trackchtrue}{}%
    \SB@replayingfalse%
    \SB@obeylines%
    \@ifstar{\global\SB@vnumfalse\everypar{}}%
            {\global\SB@vnumtrue}%
}
\newcommand\SB@endverse{%
  \ifSB@insong%
    \ifSB@inverse%
      \endgroup%
      \SB@inversefalse%
      \ifSB@vnum\stepcounter{versenum}\fi%
      \vskip\versesep%
    \else\ifSB@inchorus%
      \SB@Error{Encountered \protect\endverse\space%
      while processing a chorus}{Song \songnumstyle{songnum}\space%
      might have a \protect\beginchorus concluded by\space%
      \protect\endverse instead of \protect\endchorus.}%
      \SB@endchorus%
    \else%
      \SB@Error{Encountered \protect\endverse\space%
      without first seeing a \protect\beginverse}{Song\space%
      \songnumstyle{songnum} might have an \protect\endverse\space%
      with no matching \protect\beginverse.}%
    \fi\fi%
  \else%
    \SB@Error{Encountered an \protect\endverse\space%
    outside of any song}{After song \SB@prevsong, there is an\space%
    \protect\endverse line not preceded by a \protect\begin%
    song line.}%
  \fi%
}
\newbox\SB@chorusbox
\newlength\SB@chorusheight
\newlength\SB@chorusdepth
\newcommand\SB@beginchorus{%
  \ifSB@insong
    \ifSB@inverse%
      \SB@Error{Encountered \protect\beginchorus\space%
      without seeing an \protect\endverse for the preceding verse}%
      {Song \songnumstyle{songnum} might have a \protect\begin%
      verse with no matching \protect\endverse.}%
      \SB@endverse%
    \fi%
    \ifSB@inchorus%
      \SB@Error{Encountered \protect\beginchorus\space%
      without seeing an \protect\endchorus for the preceding chorus}%
      {Song \songnumstyle{songnum} might have a \protect\begin%
      chorus with no matching \protect\endchorus.}%
      \SB@endchorus%
    \fi%
  \else%
    \SB@Error{Encountered \protect\beginchorus\space%
    without seeing a \protect\beginsong line first}{After song\space%
    \songnumstyle{songnum} there is a \protect\beginchorus\space%
    line outside of any song.}%
    \SB@beginsong{Unknown Song}%
  \fi%
  \SB@inchorustrue%
  \SB@stanzabreak%
  \setbox\SB@chorusbox\vbox\bgroup%
    \ifoverhead%
      \advance\hsize-2\SB@chorusindent\relax%
      \ifmeasures%
        \advance\hsize-3pt%
      \else%
        \advance\hsize-2pt%
      \fi%
      \leftskip\z@\@plus1fil%
      \rightskip\leftskip%
      \parfillskip\z@skip%
      \parindent\z@%
    \else%
      \leftskip\parindent%
      \advance\leftskip\SB@chorusindent\relax%
      \ifmeasures%
        \advance\leftskip1.5pt%
      \else%
        \advance\leftskip\p@%
      \fi%
      \parindent-\parindent%
    \fi%
    \SB@loadaccidentals%
    \SB@obeylines%
}
\newcommand\SB@endchorus{%
  \ifSB@insong%
    \ifSB@inchorus%
      \egroup%
      \SB@inchorusfalse%
      \SB@chorusheight\ht\SB@chorusbox%
      \SB@chorusdepth\dp\SB@chorusbox%
      \ifoverhead\hbox{%
        \advance\SB@chorusheight\SB@chorusdepth%
        \ifmeasures%
          \vrule\@width1.5pt\@height\SB@chorusheight%
                \@depth\SB@chorusdepth%
        \else%
          \vrule\@width\p@\@height\SB@chorusheight%
                \@depth\SB@chorusdepth%
        \fi%
        \hskip\SB@chorusindent%
        \vbox{\kern\SB@chorusdepth\unvbox\SB@chorusbox}%
        \hskip\SB@chorusindent%
        \ifmeasures%
          \vrule\@width1.5pt\@height\SB@chorusheight%
                \@depth\SB@chorusdepth%
        \else%
          \vrule\@width\p@\@height\SB@chorusheight%
                \@depth\SB@chorusdepth%
        \fi%
      }\else%
        \advance\SB@chorusheight2\SB@chorusdepth%
        \SB@cssanswer\SB@chorusheight\relax%
        \SB@computess{1}{\@plus}{\SB@chorusbox}%
        \SB@computess{-1}{\@minus}{\SB@chorusbox}%
        \nointerlineskip\null\nobreak%
        \ifmeasures%
          \ifSB@measuresreq%
            \leaders\vrule \@width1.5pt\vskip\SB@cssanswer%
          \else%
            \leaders\vrule\vskip\SB@cssanswer%
          \fi%
        \else%
          \leaders\vrule\vskip\SB@cssanswer%
        \fi%
        \advance\SB@cssanswer-\SB@chorusdepth%
        \vskip-\SB@cssanswer%
        \unvbox\SB@chorusbox%
      \fi%
      \vskip\versesep%
    \else\ifSB@inverse%
      \SB@Error{Encountered an \protect\endchorus\space%
      while processing a verse}{Song \songnumstyle{songnum}\space%
      might have a \protect\beginverse concluded by \protect\end%
      chorus instead of \protect\endverse.}%
      \SB@endverse%
    \else%
      \SB@Error{Encountered \protect\endchorus\space%
      without first seeing a \protect\beginchorus}{Song\space%
      \songnumstyle{songnum} might have an \protect\endchorus\space%
      with no matching \protect\beginchorus.}%
    \fi\fi%
  \else%
    \SB@Error{Encountered an \protect\endchorus\space%
    outside of any song}{After song \SB@prevsong, there is an\space%
    \protect\endchorus line not preceded by a \protect\begin%
    song line.}%
  \fi%
}
\newskip\SB@cssanswer
\newcommand\SB@computess[3]{{%
  \vbadness\@M\vfuzz\maxdimen%
  \SB@dimen4096pt %
  \setbox\SB@box\vbox spread#1\SB@dimen{\unvcopy#3}%
  \ifnum\badness=0 %
    \global\advance\SB@cssanswer\z@#2 1fil\relax%
  \else%
    \SB@dimenii\SB@dimen%
    \loop%
      \SB@dimenii0.5\SB@dimenii%
      \ifnum\badness<100 %
        \advance\SB@dimen\SB@dimenii%
      \else
        \advance\SB@dimen-\SB@dimenii%
      \fi%
      \setbox\SB@box\vbox spread#1\SB@dimen{\unvcopy#3}%
      \ifnum\badness=100 \SB@dimenii\z@\fi%
    \ifdim\SB@dimenii>0.1pt\repeat%
    \ifdim\SB@dimen<0.1pt \SB@dimen\z@\fi%
    \global\advance\SB@cssanswer\z@#2\SB@dimen\relax%
  \fi%
}}
\newcommand\SB@beginchordedonly{%
  \ifchorded\else\setbox\SB@box\vbox\bgroup\fi%
}
\newcommand\SB@endchordedonly{\ifchorded\else\egroup\fi}
\newcommand\SB@beginlyriconly{%
  \ifchorded\setbox\SB@box\vbox\bgroup\fi%
}
\newcommand\SB@endlyriconly{\ifchorded\egroup\fi}
\newbox\SB@srbox
\newcommand\SB@beginscripture[1]{%
  \ifSB@insong%
    \SB@Error{Encountered a \protect\beginscripture%
    \space inside a song}{Song \songnumstyle{songnum} might be\space%
    missing an \protect\endsong line.}%
    \SB@endsong%
  \fi%
  \ifSB@inscripture%
    \SB@Error{Encountered a \protect\beginscripture\space%
    without seeing an \protect\endscripture for the preceding\space%
    scripture quote}{A scripture quote after song \SB@prevsong\space%
    is missing an \protect\endscripture line.}%
    \SB@endscripture%
  \fi%
  \SB@inscripturetrue%
  \ifSB@omitscrip%
    \setbox\SB@box\vbox\bgroup%
  \else%
    \setbox\SB@srbox\hbox{\printscrcite{\SB@parsesrefs{#1}}}%
    \setbox\SB@songbox\vbox\bgroup%
      \hsize\SB@colwidth%
      \hrule\@height\p@\@width\SB@colwidth%
      \nobreak\vskip5pt%
      \SB@parindent\parindent\parindent\z@%
      \parskip\z@skip\parfillskip\z@\@plus1fil%
      \leftskip\SB@parindent\rightskip\SB@parindent%
      \scripturefont%
      \baselineskip\f@size pt\@plus\p@\relax%
      \advance\baselineskip\p@\relax%
      \emergencystretch0.3em%
      \everypar{%
        \global\SB@hangafter\hangafter%
        \global\SB@hangindent\hangindent%
      }%
  \fi%
}
\newcommand\SB@endscripture{%
  \ifSB@inscripture
    \ifSB@omitscrip%
      \egroup%
    \else%
        \ifvmode%
          \SB@dimen\z@%
          \ifnum\prevgraf>\SB@hangafter%
            \SB@dimen\SB@hangindent%
          \fi%
          \setbox\SB@box\lastbox%
          \nointerlineskip\noindent%
          \hskip-\leftskip\kern\SB@dimen%
          \unhbox\SB@box%
        \fi%
        \unskip\nobreak\hfil\penalty50\hskip0.8em\null\nobreak\hfil%
        \box\SB@srbox\kern-\SB@parindent%
        {\parfillskip\z@\finalhyphendemerits2000\par}%
        \nobreak\kern-4.5pt%
        \hbox{\vrule\@height\p@\@width\SB@colwidth}%
        \kern-\p@%
      \egroup%
      \ifpartiallist\else%
        \SB@submitsong%
      \fi%
    \fi%
    \SB@inscripturefalse%
  \else%
    \ifSB@insong%
      \SB@Error{Encountered an \protect\endscripture%
      \space while processing a song}{Song \songnumstyle{songnum}%
      \space ends with \protect\endscripture when it should end with%
      \space\protect\endsong.}%
      \SB@endsong%
    \else%
      \SB@Error{Encountered an \protect\endscripture%
      \space without first seeing a \protect\beginscripture}%
      {After song \SB@prevsong\space there is an \protect\end%
      scripture with no matching \protect\beginscripture.}%
    \fi%
  \fi%
}
\newcommand\SB@Acolon{\SB@colon\Acolon\z@skip}
\newcommand\SB@Bcolon{\SB@colon\Bcolon\SB@parindent}
\newcount\SB@hangafter
\newdimen\SB@hangindent
\newcommand\SB@colon[2]{%
  \ifSB@inscripture\else%
    \SB@Error{Encountered \protect#1 outside\space%
    a scripture quote}{\protect#1 can only appear between\space%
    \protect\beginscripture and \protect\endscripture lines.}%
    \SB@beginscripture{Unknown}%
  \fi%
  \SB@tempobeylines%
    \rightskip\SB@parindent\@plus4em%
    \hangafter\@ne\hangindent2\SB@parindent%
    \hskip#2\relax%
}
\newcommand\SB@strophe{%
  \ifSB@inscripture\else%
    \SB@Error{Encountered a \protect\strophe outside\space%
    a scripture quote}{\protect\strophe can only appear between\space%
    \protect\beginscripture and \protect\endscripture lines.}%
    \SB@beginscripture{Unknown}%
  \fi%
  \vskip4pt\@plus2pt\@minus3pt\relax%
}
\newcommand\SB@scripindent{%
  \ifSB@inscripture\else%
    \SB@Error{Encountered a \protect\scripindent\space%
    outside a scripture quote}{\protect\scripindent can only\space%
    appear between \protect\beginscripture and \protect\end%
    scripture lines.}%
    \SB@beginscripture{Unknown}%
  \fi%
  \ifhmode\par\fi%
  \advance\leftskip\SB@parindent\relax%
}
\newcommand\SB@scripoutdent{%
  \ifSB@inscripture\else%
    \SB@Error{Encountered a \protect\scripoutdent\space%
    outside a scripture quote}{\protect\scripoutdent can only\space%
    appear between \protect\beginscripture and \protect\end%
    scripture lines.}%
    \SB@beginscripture{Unknown}%
  \fi%
  \ifhmode\par\fi%
  \advance\leftskip-\SB@parindent\relax%
}
\newcommand\SB@next{}
\newcommand\SB@donext{}
\newcommand\SB@dothis{}
\newcommand\SB@quotesactive{%
  \catcode`'\active%
  \catcode``\active%
}
\newcommand\shiftdblquotes[4]{}
\newlength\SB@ldqleft
\newlength\SB@ldqright
\newlength\SB@rdqleft
\newlength\SB@rdqright
\newcommand\SB@scanlq{}
\newcommand\SB@scanrq{}
\newcommand\SB@dolq{}
\newcommand\SB@dorq{}
{
  \SB@quotesactive
  \gdef\shiftdblquotes#1#2#3#4{%
    \SB@ldqleft#1\relax%
    \SB@ldqright#2\relax%
    \SB@rdqleft#3\relax%
    \SB@rdqright#4\relax%
    \SB@quotesactive%
    \def`{\futurelet\SB@next\SB@scanlq}%
    \def'{\futurelet\SB@next\SB@scanrq}%
  }
  \gdef\SB@scanlq{%
    \ifx\SB@next`%
      \let\SB@donext\SB@dolq%
    \else%
      \let\SB@donext\lq%
    \fi%
    \SB@donext%
  }
  \gdef\SB@scanrq{%
    \ifx\SB@next'%
      \let\SB@donext\SB@dorq%
    \else%
      \let\SB@donext\rq%
    \fi%
    \SB@donext%
  }
  \gdef\SB@dolq`{%
    \ifvmode\leavevmode\else\/\fi%
    \vadjust{}%
    \kern\SB@ldqleft\lq\lq\kern\SB@ldqright%
    \vadjust{}%
  }
  \gdef\SB@dorq'{%
    \ifvmode\leavevmode\else\/\fi%
    \vadjust{}%
    \kern\SB@rdqleft\rq\rq\kern\SB@rdqright%
    \vadjust{}%
  }
}
\newcommand\SB@boxup[1]{%
  \setbox\SB@box\hbox{#1}%
  \SB@dimen\wd\SB@box%
  \advance\SB@dimen6pt%
  \advance\SB@dimen\leftskip%
  \advance\SB@dimen\rightskip%
  \ifdim\SB@dimen>\SB@colwidth%
    \vbox{%
      \advance\hsize-6pt%
      \advance\hsize-\leftskip%
      \advance\hsize-\rightskip%
      \advance\hsize-\parindent%
      \baselineskip\f@size pt\relax%
      \advance\baselineskip\p@\relax%
      \leftskip\z@skip\rightskip\z@skip%
      \parfillskip\z@\@plus1fil\parindent\z@%
      \unhbox\SB@box\par%
      \kern\z@%
    }%
  \else%
    \vbox{\box\SB@box\kern\z@}%
  \fi%
}
\edef\SB@thezpt{\the\z@}
\newcommand\SB@ifskipzero[3]{%
  \edef\SB@temp{\the#1}%
  \ifx\SB@temp\SB@thezpt#2\else#3\fi%
}
\newcommand\SB@textnote[1]{%
  \SB@ifskipzero\lastskip{\ifdim\lastkern=\z@\nobreak\fi}{}%
  \vskip2pt%
  \begingroup%
    \everypar{}%
    \ifoverhead\versenumwidth\z@\fi%
    \ifSB@inverse%
      \indent\hskip-\versenumwidth\relax
    \else%
      \ifSB@inchorus%
        \indent\hskip-\versenumwidth\relax%
      \else%
        \noindent%
      \fi%
    \fi%
    \SB@colorbox{\SB@boxup{#1}}\par%
  \endgroup%
  \nobreak%
  \ifSB@inverse%
    \vskip2pt\relax%
  \else%
    \ifSB@inchorus%
      \vskip2pt\relax%
    \else%
      \vskip\versesep\relax%
    \fi%
  \fi%
}
\newcommand\SB@musicnote[1]{\ifchorded\SB@textnote{#1}\fi}
\newcommand\echo[1]{{\fontshape{sl}\selectfont(#1)}}
\newcount\SB@notenum
\newcount\SB@transposefactor
\newif\ifSB@prefshrps
\newif\ifSB@firstchord
\newcommand\SB@transpose[1]{%
  \advance\SB@transposefactor by#1\relax%
  \ifnum\SB@transposefactor>11\advance\SB@transposefactor-12 \fi%
  \ifnum\SB@transposefactor<0\advance\SB@transposefactor12 \fi%
  \SB@firstchordtrue%
}
\newcommand\SB@capo[1]{%
  \iftransposecapos\SB@transpose{#1}\else\SB@musicnote{capo #1}\fi%
}
\newcommand\SB@prefshrps{\SB@prefshrpstrue\SB@firstchordfalse}
\newcommand\SB@prefflts{\SB@prefshrpsfalse\SB@firstchordfalse}
\newcommand\SB@transposed[1]{%
  \ifnum\SB@transposefactor=0 #1\else%
    \SB@trchord{}%
    \SB@trscan#1\SB@trend%
    \trchordformat{#1}{\the\SB@trchord}%
  \fi%
}
\newcommand\trchordformat[2]{#2}
\newtoks\SB@trchord
\newcommand\SB@trscan{\futurelet\SB@next\SB@trwalk}
\newcommand\SB@trwalk{%
  \ifx\SB@next\bgroup%
    \let\SB@donext\SB@trgroup%
  \else\ifx\SB@next\egroup%
    \SB@trchord\expandafter{\the\SB@trchord\egroup}%
    \let\SB@donext\SB@trgroup%
  \else\ifcat\noexpand\SB@next\noexpand\@sptoken%
    \SB@trchord\expandafter{\the\SB@trchord\ }%
    \let\SB@donext\SB@trspace%
  \else%
    \let\SB@donext\SB@trstep%
  \fi\fi\fi%
  \SB@donext%
}
\newcommand\SB@trgroup[1]{%
  \SB@trchord\expandafter{\the\SB@trchord{#1}}%
  \SB@trscan%
}
\newcommand\SB@trspace{%
  \afterassignment\SB@trscan%
  \let\SB@next= }
\newcommand\SB@trstep[1]{%
  \ifx\SB@next A%
    \SB@notenum0%
    \let\SB@donext\SB@trpeekacc%
  \else\ifx\SB@next B%
    \SB@notenum2%
    \let\SB@donext\SB@trpeekacc%
  \else\ifx\SB@next C%
    \SB@notenum3%
    \let\SB@donext\SB@trpeekacc%
  \else\ifx\SB@next D%
    \SB@notenum5%
    \let\SB@donext\SB@trpeekacc%
  \else\ifx\SB@next E%
    \SB@notenum7%
    \let\SB@donext\SB@trpeekacc%
  \else\ifx\SB@next F%
    \SB@notenum8%
    \let\SB@donext\SB@trpeekacc%
  \else\ifx\SB@next G%
    \SB@notenum10%
    \let\SB@donext\SB@trpeekacc%
  \else\ifx\SB@next\tablature%
    \let\SB@donext\SB@trtab%
  \else\ifx\SB@next\SB@trend
    \let\SB@donext\relax%
  \else%
    \SB@trchord\expandafter{\the\SB@trchord#1}%
    \let\SB@donext\SB@trscan%
  \fi\fi\fi\fi\fi\fi\fi\fi\fi%
  \SB@donext%
}
\newcommand\SB@trpeekacc{\futurelet\SB@next\SB@tracc}
\newcommand\SB@tracc{%
  \ifx\SB@next\flt%
    \advance\SB@notenum\m@ne%
    \let\SB@donext\SB@trgetacc%
  \else\ifx\SB@next\shrp%
    \advance\SB@notenum\@ne%
    \let\SB@donext\SB@trgetacc%
  \else%
    \let\SB@donext\SB@trtrans%
  \fi\fi%
  \SB@donext%
}
\newcommand\SB@trgetacc[1]{\futurelet\SB@next\SB@trtrans}
\newcommand\SB@trtrans{%
  \advance\SB@notenum\SB@transposefactor%
  \ifnum\SB@notenum<0 \advance\SB@notenum12 \fi%
  \ifnum\SB@notenum>11 \advance\SB@notenum-12 \fi%
  \ifSB@firstchord%
    \global\SB@firstchordfalse%
    \ifcase\SB@notenum%
      \global\SB@prefshrpstrue\or% A
      \global\SB@prefshrpsfalse\or% Bb
      \global\SB@prefshrpstrue\or% B
      \ifx\SB@next m% C
        \global\SB@prefshrpsfalse%
      \else%
        \global\SB@prefshrpstrue%
      \fi\or%
      \global\SB@prefshrpstrue\or% C#
      \ifx\SB@next m% D
        \global\SB@prefshrpsfalse%
      \else%
        \global\SB@prefshrpstrue%
      \fi\or%
      \global\SB@prefshrpsfalse\or% Eb
      \global\SB@prefshrpstrue\or% E
      \global\SB@prefshrpsfalse\or% F
      \global\SB@prefshrpstrue\or% F#
      \ifx\SB@next m% G
        \global\SB@prefshrpsfalse%
      \else%
        \global\SB@prefshrpstrue%
      \fi\or%
      \global\SB@prefshrpsfalse\else% Ab
      \global\SB@firstchordtrue% non-chord
    \fi%
  \fi%
  \ifSB@prefshrps%
    \ifcase\SB@notenum%
      \SB@trchord\expandafter{\the\SB@trchord A}\or%
      \SB@trchord\expandafter{\the\SB@trchord A\shrp}\or%
      \SB@trchord\expandafter{\the\SB@trchord B}\or%
      \SB@trchord\expandafter{\the\SB@trchord C}\or%
      \SB@trchord\expandafter{\the\SB@trchord C\shrp}\or%
      \SB@trchord\expandafter{\the\SB@trchord D}\or%
      \SB@trchord\expandafter{\the\SB@trchord D\shrp}\or%
      \SB@trchord\expandafter{\the\SB@trchord E}\or%
      \SB@trchord\expandafter{\the\SB@trchord F}\or%
      \SB@trchord\expandafter{\the\SB@trchord F\shrp}\or%
      \SB@trchord\expandafter{\the\SB@trchord G}\or%
      \SB@trchord\expandafter{\the\SB@trchord G\shrp}%
    \fi%
  \else%
    \ifcase\SB@notenum%
      \SB@trchord\expandafter{\the\SB@trchord A}\or%
      \SB@trchord\expandafter{\the\SB@trchord B\flt}\or%
      \SB@trchord\expandafter{\the\SB@trchord B}\or%
      \SB@trchord\expandafter{\the\SB@trchord C}\or%
      \SB@trchord\expandafter{\the\SB@trchord D\flt}\or%
      \SB@trchord\expandafter{\the\SB@trchord D}\or%
      \SB@trchord\expandafter{\the\SB@trchord E\flt}\or%
      \SB@trchord\expandafter{\the\SB@trchord E}\or%
      \SB@trchord\expandafter{\the\SB@trchord F}\or%
      \SB@trchord\expandafter{\the\SB@trchord G\flt}\or%
      \SB@trchord\expandafter{\the\SB@trchord G}\or%
      \SB@trchord\expandafter{\the\SB@trchord A\flt}%
    \fi%
  \fi%
  \SB@trscan%
}%
\newcommand\SB@trtab[4]{\SB@trscan#1}
\newcommand\SB@trend{%
  \SB@Error{Internal Error: Transposition failed.}%
           {This error should not occur.}%
}
\newif\ifSB@wordends
\newif\ifSB@brokenword
\newdimen\SB@chordwidth
\newskip\SB@lastskip
\newcount\SB@spacefactor
\newtoks\SB@lyric
\newcount\SB@numhyps
\newtoks\SB@lyricnohyp
\newbox\SB@lyricbox
\newbox\SB@chordbox
\newcommand\SB@chbstok{}
\newcommand\SB@setchord{}
{
  \catcode`^\active
  \gdef\SB@setchord#1{%
    \SB@gettabindtrue\SB@nohattrue%
    \setbox\SB@chordbox\hbox{\begingroup%
      \def^{\global\SB@nohatfalse}%
      \printchord{\vphantom/\SB@transposed{#1}\kern0.2em}%
    \endgroup}%
    \ifSB@trackch\ifSB@nohat%
      \global\SB@chist\expandafter{\the\SB@chist#1\\}%
    \fi\fi%
    \let\SB@noreplay\@firstofone%
  }
}
\newtoks\SB@accenttests
\newcommand\SB@testaccent[1]{\ifx\SB@next#1\SB@testtrue\fi}
\newcommand\DeclareLyricChar[1]{%
  \ifcat\noexpand#1\relax%
    \SB@accenttests\expandafter{\the\SB@accenttests\SB@testaccent#1}%
  \else\ifcat\noexpand#1\noexpand~%
    \SB@accenttests\expandafter{\the\SB@accenttests\SB@testaccent#1}%
  \else%
    \SB@Error{Invalid argument to \protect\DeclareLyricChar.}%
      {\protect\DeclareLyricChar\space accepts only a single-%
       token argument that is a macro or active character.}%
  \fi\fi%
}
\DeclareLyricChar\`
\DeclareLyricChar\'
\DeclareLyricChar\^
\DeclareLyricChar\"
\DeclareLyricChar\~
\DeclareLyricChar\=
\DeclareLyricChar\.
\DeclareLyricChar\u
\DeclareLyricChar\v
\DeclareLyricChar\H
\DeclareLyricChar\t
\DeclareLyricChar\c
\DeclareLyricChar\d
\DeclareLyricChar\b
\DeclareLyricChar\oe
\DeclareLyricChar\OE
\DeclareLyricChar\ae
\DeclareLyricChar\AE
\DeclareLyricChar\aa
\DeclareLyricChar\AA
\DeclareLyricChar\o
\DeclareLyricChar\O
\DeclareLyricChar\l
\DeclareLyricChar\L
\DeclareLyricChar\ss
\DeclareLyricChar\i
\DeclareLyricChar\j
\DeclareLyricChar\/
\DeclareLyricChar\-
\DeclareLyricChar\discretionary
\newcount\SB@octets
\newcommand\SB@UTFtest{}
\edef\SB@UTFtest#1{%
  \noexpand\SB@UTFtester#1%
  \string\UTFviii@zero@octets%
  \noexpand\SB@UTFtester%
}
\begingroup
  \escapechar-1
  \xdef\SB@two{\string\two}
  \xdef\SB@three{\string\three}
  \xdef\SB@four{\string\four}
  \xdef\SB@temp{\string\@octets}
\endgroup
\edef\SB@temp{##1\string\UTFviii@##2\SB@temp##3}
\expandafter\def\expandafter\SB@UTFtester\SB@temp\SB@UTFtester{%
  \def\SB@temp{#2}%
  \ifx\SB@temp\SB@two%
    \SB@octets\tw@%
  \else\ifx\SB@temp\SB@three%
    \SB@octets\thr@@%
  \else\ifx\SB@temp\SB@four%
    \SB@octets4 %
  \else%
    \SB@octets0 %
  \fi\fi\fi%
}
\newcommand\SB@chord[1]{%
  \SB@setchord{#1}%
  \setbox\SB@lyricbox\hbox{\kern\SB@tabindent}%
  \SB@tabindent\z@%
  \SB@lyric{}%
  \SB@numhyps0 %
  \SB@spcinit%
  \let\SB@dothis\SB@chstart%
  \SB@chscan%
}
\newcommand\SB@spcinit{}
\newcommand\MultiwordChords{%
  \def\SB@spcinit{%
    \let\SB@chdone\SB@chlyrdone%
    \def\SB@chimpspace{\let\SB@donext\SB@chdone}%
    \def\SB@chexpspace{\let\SB@donext\SB@chdone}%
    \let\SB@chespace\SB@chendspace%
  }%
}
\newcommand\SB@chscan{\futurelet\SB@next\SB@chmain}
\newcommand\SB@chmain{\SB@dothis\SB@donext}
\newcommand\SB@chstart{%
  \ifx\SB@next`%
    \let\SB@donext\SB@chstep%
  \else%
    \the\SB@lyric%
    \SB@lyric{}%
    \let\SB@dothis\SB@chnorm%
    \SB@chnorm%
  \fi%
}
\newcommand\SB@chnorm{%
  \ifcat\noexpand\SB@next A%
    \SB@chespace\let\SB@donext\SB@chstep%
  \else%
    \SB@chtrymacro%
  \fi%
}
\newcommand\SB@chtrymacro{%
  \ifcat\noexpand\SB@next\relax%
    \SB@chmacro%
  \else%
    \SB@chtryactive%
  \fi%
}
\newcommand\SB@chtryactive{%
  \ifcat\noexpand\SB@next\noexpand~%
    \SB@chactive%
  \else%
    \SB@chother%
  \fi%
}
\newcommand\SB@chother{%
  \ifcat\noexpand\SB@next\noexpand\@sptoken%
    \SB@chexpspace%
  \else\ifcat\noexpand\SB@next\noexpand\bgroup%
    \SB@chespace\let\SB@donext\SB@chbgroup%
  \else\ifcat\noexpand\SB@next\noexpand\egroup%
    \SB@chespace\let\SB@donext\SB@chegroup%
  \else\ifx\SB@next-%
    \SB@numhyps\@ne\relax%
    \SB@lyricnohyp\expandafter{\the\SB@lyric}%
    \let\SB@dothis\SB@chhyph%
    \SB@chespace\let\SB@donext\SB@chstep%
  \else%
    \SB@chespace\let\SB@donext\SB@chstep%
  \fi\fi\fi\fi%
}
\newcommand\SB@chmacro{%
  \ifx\SB@next\measurebar%
    \SB@chmbar%
  \else\ifx\SB@next\mbar%
    \SB@chmbar%
  \else\ifx\SB@next\ch%
    \SB@chespace\let\SB@donext\SB@chlig%
  \else\ifx\SB@next\SB@mch%
    \SB@chespace\let\SB@donext\SB@mchlig%
  \else%
    \SB@testfalse\the\SB@accenttests%
    \ifSB@test%
      \SB@chespace\let\SB@donext\SB@chstep%
    \else\ifx\SB@next\ %
      \SB@chimpspace%
    \else%
      \expandafter\SB@UTFtest\expandafter{\meaning\SB@next}%
      \ifcase\SB@octets%
        \let\SB@donext\SB@chdone%
      \or%
        \SB@chespace\let\SB@donext\SB@chstep%
      \or%
        \SB@chespace\let\SB@donext\SB@chsteptwo%
      \or%
        \SB@chespace\let\SB@donext\SB@chstepthree%
      \or%
        \SB@chespace\let\SB@donext\SB@chstepfour%
      \else%
        \let\SB@donext\SB@chdone%
      \fi%
    \fi\fi%
  \fi\fi\fi\fi%
}
\newcommand\SB@chactive{}
{
  \catcode`|\active
  \gdef\SB@chactive{%
    \ifx\SB@next|%
      \SB@chmbar%
    \else\ifx\SB@next~%
      \SB@chimpspace%
    \else%
      \SB@testfalse\the\SB@accenttests%
      \ifSB@test%
        \SB@chespace\let\SB@donext\SB@chstep%
      \else%
        \let\SB@donext\SB@chdone%
      \fi%
    \fi\fi%
  }
}
\newcommand\SB@chstep[1]{%
  \SB@lyric\expandafter{\the\SB@lyric#1}%
  \SB@chscan%
}
\newcommand\SB@chsteptwo[2]{%
  \SB@lyric\expandafter{\the\SB@lyric#1#2}%
  \SB@chscan%
}
\newcommand\SB@chstepthree[3]{%
  \SB@lyric\expandafter{\the\SB@lyric#1#2#3}%
  \SB@chscan%
}
\newcommand\SB@chstepfour[4]{%
  \SB@lyric\expandafter{\the\SB@lyric#1#2#3#4}%
  \SB@chscan%
}
\newcommand\SB@chhyph{%
  \ifx\SB@next-%
    \advance\SB@numhyps\@ne\relax%
    \let\SB@donext\SB@chstep%
  \else%
    \let\SB@donext\SB@chdone%
  \fi%
}
\newcommand\SB@chimpspace{\let\SB@donext\SB@chdone}
\newcommand\SB@chexpspace{\let\SB@donext\SB@chdone}
\newcommand\SB@chespace{}
\newcommand\SB@chendspace{%
  \let\SB@chdone\SB@chlyrdone%
  \def\SB@chexpspace{\SB@chbspace\SB@chexpspace}%
  \def\SB@chimpspace{\SB@chbspace\SB@chimpspace}%
  \def\SB@chespace{}%
}
\newcommand\SB@chbspace{%
  \setbox\SB@lyricbox\hbox{%
    \unhbox\SB@lyricbox%
    \the\SB@lyric%
  }%
  \SB@lyric{}%
  \ifdim\wd\SB@lyricbox<\wd\SB@chordbox%
    \let\SB@chbstok= \SB@next%
    \def\SB@chexpspace{\let\SB@donext\SB@chgetspace}%
    \def\SB@chimpspace{\let\SB@donext\SB@chstep}%
    \let\SB@chespace\SB@chendspace%
    \let\SB@chdone\SB@chspcdone%
  \else%
    \def\SB@chimpspace{\let\SB@donext\SB@chdone}%
    \def\SB@chexpspace{\let\SB@donext\SB@chdone}%
  \fi%
}
\newcommand\SB@chgetspace{%
  \SB@lyric\expandafter{\the\SB@lyric\@sptoken}%
  \afterassignment\SB@chscan%
  \let\SB@next= }
\newcommand\SB@chmbar{%
  \ifmeasures%
    \let\SB@donext\SB@chdone%
  \else%
    \SB@chespace\let\SB@donext\SB@chstep%
  \fi%
}
\newcommand\SB@chbgroup[1]{%
  \SB@lyric\expandafter{\the\SB@lyric{#1}}%
  \SB@chscan%
}
\newcommand\SB@chegroup{%
  \afterassignment\SB@chegrptwo%
  \let\SB@next= }
\newcommand\SB@chegrptwo{%
  \futurelet\SB@next\SB@chegrpthr%
}
\newcommand\SB@chegrpthr{%
  \SB@chdone\egroup%
}
\newcommand\SB@chlig[5]{%
  \SB@ligpre{{#3}}%
  \SB@ligpost{\[#2]{#4}}%
  \SB@ligfull{\[\SB@noreplay{\hphantom{#3}}#2]{#5}}%
  \SB@chdone%
}
\newcommand\SB@mchlig[5]{%
  \SB@lyric\expandafter{\the\SB@lyric#3}%
  \let\SB@next\measurebar%
  \SB@ligpost{\measurebar\[#2]{#4}}%
  \SB@ligfull{\measurebar\[#2]{#4}}%
  \SB@chdone%
}
\newcommand\SB@chlyrdone{%
  \setbox\SB@lyricbox\hbox{%
    \unhbox\SB@lyricbox%
    \ifnum\SB@numhyps=\@ne\relax%
      \the\SB@lyricnohyp%
    \else%
      \the\SB@lyric%
    \fi%
  }%
  \SB@emitchord%
}
\newcommand\SB@chspcdone{%
  \let\SB@next= \SB@chbstok%
  \expandafter\SB@emitchord\the\SB@lyric%
}
\newcommand\SB@chdone{}
\let\SB@chdone\SB@chlyrdone
\newtoks\SB@ligpre
\newtoks\SB@ligpost
\newtoks\SB@ligfull
\newtoks\SB@ecpost
\newcommand\SB@clearlig{%
  \SB@ligpre{}%
  \SB@ligpost{}%
  \SB@ligfull{}%
  \SB@ecpost{}%
}
\newcommand\SB@emitchord{%
  \ifchorded%
    \ifSB@inverse\else%
      \ifSB@inchorus\else%
        \SB@Error{Song \songnumstyle{songnum}\space%
        seems to have chords that appear outside of any verse or\space%
        chorus}{All chords and lyrics should appear between\space%
        \protect\beginverse and \protect\endverse, or between\space%
        \protect\beginchorus and \protect\endchorus.}%
      \fi%
    \fi%
    \SB@wordendsfalse%
    \ifcat\noexpand\SB@next\noexpand\@sptoken\SB@wordendstrue\fi%
    \ifx\SB@next\par\SB@wordendstrue\fi%
    \ifx\SB@next\SB@outerpar\SB@wordendstrue\fi%
    \ifx\SB@next\egroup\SB@wordendstrue\fi%
    \ifcat\noexpand\SB@next.\SB@wordendstrue\fi%
    \SB@chordwidth\wd\SB@chordbox%
    \ifvmode\leavevmode\fi%
    \SB@brokenwordfalse%
    \ifdim\wd\SB@lyricbox>\z@%
      \ifdim\SB@chordwidth>\wd\SB@lyricbox%
        \ifSB@wordends\else%
          \SB@brokenwordtrue%
        \fi%
      \fi%
    \else%
      \SB@lastskip\lastskip%
      \unskip\penalty200\hskip\SB@lastskip%
    \fi%
    \ifnum\SB@numhyps>0 %
      \ifnum\SB@numhyps>\@ne\relax%
        \SB@brokenwordfalse%
      \else%
        \SB@brokenwordtrue%
      \fi%
    \fi%
    \vbox{\baselineskip\f@size pt\kern2pt%
      \ifSB@brokenword%
        \global\setbox\SB@lyricbox\hbox{%
          \unhbox\SB@lyricbox%
          \the\SB@ligpre%
        }%
        \ifdim\wd\SB@lyricbox>\SB@chordwidth%
          \global\SB@chordwidth\wd\SB@lyricbox%
        \fi%
        \global\advance\SB@chordwidth0.5em%
        \hbox to\SB@chordwidth{\unhbox\SB@chordbox\hfil}%
        \kern-2pt%
        \hbox to\SB@chordwidth{%
          \unhcopy\SB@lyricbox\hfil\char\hyphenchar\font\hfil%
        }%
        \global\SB@spacefactor1000 %
        \global\SB@ecpost%
          \expandafter{\expandafter\SB@clearlig\the\SB@ligpost}%
      \else%
        \hbox{\unhbox\SB@chordbox\hfil}%
        \kern-2pt%
        \hbox{%
          \unhcopy\SB@lyricbox%
          \global\SB@spacefactor\spacefactor%
          \hfil%
        }%
        \global\SB@ecpost%
          \expandafter{\expandafter\SB@clearlig\the\SB@ligfull}%
      \fi%
    }%
    \ifSB@wordends%
      \ifdim\wd\SB@lyricbox>\z@\else\nobreak\fi%
    \else%
      \nobreak\spacefactor\SB@spacefactor%
    \fi%
  \fi%
  \the\SB@ecpost%
}
\newcommand\shrp{\raise3pt\hbox{\small\#}\kern-\p@}
\newcommand\flt{\thinspace\raise3pt\hbox{\normalsize$\flat$}}
{
  \catcode`&\active
  \catcode`#\active
  \catcode`|\active
  \catcode`^\active
  \catcode`*6
  \gdef\SB@loadaccidentals{%
    \catcode`#\active\catcode`&\active%
    \catcode`^\ifchorded\active\else9 \fi%
    \catcode`|\ifmeasures\active\else9 \fi%
    \let&\flt%
    \let#\shrp%
    \let^\SB@replay%
    \def|{\measurebar}%
    \def\[**1]{\SB@bracket{**1}}%
  }
}
\newif\ifSB@trackch
\newif\ifSB@replaying
\newtoks\SB@chist
\newtoks\SB@ctail
\newcommand\memorize{%
  \SB@trackchtrue\SB@replayingfalse%
  \global\SB@chist{\\}%
}
\newcommand\SB@replay{%
  \SB@trackchfalse%
  \ifSB@replaying\else%
    \global\SB@replayingtrue%
    \global\SB@ctail\SB@chist%
  \fi%
  \SB@ifempty\SB@ctail{%
    \SB@Error{Replayed chord has no matching chord}%
      {Song \songnumstyle{songnum} uses \protect^ more times\space%
       than there exist chords in the previously memorized\space%
       verse.}%
    \SB@toks{}%
    \let\SB@donext\@gobble%
  }{%
    \SB@lop\SB@ctail\SB@toks%
    \let\SB@donext\SB@chord%
    \let\SB@noreplay\@gobble%
  }%
  \expandafter\SB@donext\expandafter{\the\SB@toks}%
}
\newif\ifSB@nohat
\newcommand\SB@noreplay{}
\let\SB@noreplay\@firstofone
\newcommand\SB@metertop{}
\newcommand\SB@meterbot{}
\newcommand\SB@meter[2]{\gdef\SB@metertop{#1}\gdef\SB@meterbot{#2}}
\newcommand\SB@measuremark{SB@IsMeasure}
\newcommand\SB@makembar[2]{%
  \ifSB@inverse\else%
    \ifSB@inchorus\else%
      \SB@Error{Song \songnumstyle{songnum}\space%
      seems to have measure bars that appear outside of any\space%
      verse or chorus}{All measure bars (produced with\space%
      \protect\m bar or |) must appear between\space%
      \protect\beginverse and \protect\endverse, or between\space%
      \protect\beginchorus and \protect\endchorus.}%
    \fi%
  \fi%
  \ifhmode%
    \SB@lastskip\lastskip\unskip%
    \setbox\SB@box\lastbox%
    \copy\SB@box%
    \ifvbox\SB@box%
      \SB@mockvsplit\SB@box%
      \ifx\SB@firstmark\SB@measuremark%
        \penalty100\hskip1em%
      \else%
        \penalty100\hskip\SB@lastskip%
      \fi%
    \else%
      \penalty100\hskip\SB@lastskip%
    \fi%
  \fi%
  \setbox\SB@box\hbox{\tiny\sffamily{#1}}%
  \setbox\SB@boxii\hbox{\tiny\sffamily{#2}}%
  \ifdim\wd\SB@box>\wd\SB@boxii%
    \SB@dimen\wd\SB@box\relax%
  \else%
    \SB@dimen\wd\SB@boxii\relax%
  \fi%
  \ifdim\SB@dimen<0.5pt%
    \SB@dimen0.5pt%
  \fi%
  \SB@dimenii\baselineskip%
  \advance\SB@dimenii-2pt%
  \advance\SB@dimenii-\ht\SB@box%
  \advance\SB@dimenii-\dp\SB@box%
  \advance\SB@dimenii-\ht\SB@boxii%
  \advance\SB@dimenii-\dp\SB@boxii%
  \ifvmode\leavevmode\fi%
  \vbox{%
    \mark{\SB@measuremark}%
    \hbox to\SB@dimen{%
      \hfil%
      \box\SB@box%
      \hfil%
    }%
    \nointerlineskip%
    \hbox to\SB@dimen{%
      \hfil%
      \box\SB@boxii%
      \hfil%
    }%
    \nointerlineskip%
    \hbox to\SB@dimen{%
      \hfil%
      \vrule\@width0.5pt\@height\SB@dimenii%
      \hfil%
    }%
  }%
}
\newcommand\measurebar{%
  \SB@mbar{\SB@metertop}{\SB@meterbot}%
  \SB@meter{}{}%
}
\newlength\SB@fretwidth
\setlength\SB@fretwidth{6pt}
\newlength\SB@fretbarwidth
\setlength\SB@fretbarwidth{5\SB@fretwidth}
\addtolength\SB@fretbarwidth{0.4pt}
\newcommand\SB@fretnum[1]{{%
  \sffamily\fontsize{10}{10}\selectfont#1%
}}
\newcommand\SB@fret[1]{%
  \rlap{\hbox to\SB@fretwidth{\hfil\vrule\@height6pt\hfil}}%
  \hbox to\SB@fretwidth{\hfil#1\hfil}%
}
\newcommand\SB@topfret[1]{%
  \hbox to\SB@fretwidth{\hfil#1\hfil}%
}
\newcommand\SB@fretbar{%
  \nointerlineskip%
  \hbox to6\SB@fretwidth{%
    \hfil%
    \vrule\@width\SB@fretbarwidth\@height0.4pt\@depth\z@%
    \hfil%
  }%
  \nointerlineskip%
}
\newcommand\SB@topempty{\SB@topfret{}}
\newcommand\SB@fretopen{\SB@fret{}}
\newcommand\SB@frethit{\SB@fret{%
  \hbox{%
    \fontencoding{OMS}\fontfamily{cmsy}%
    \fontseries{m}\fontshape{n}%
    \fontsize{12}{12}\selectfont\char15%
  }%
}}
\newdimen\SB@tdwidth
\newtoks\SB@tabargs
\newif\ifSB@gettabind\SB@gettabindfalse
\newlength\SB@tabindent
\newif\ifSB@taberror
\newcommand\SB@tabexcess{}
\newcommand\SB@tabtail{\relax\relax\relax\relax\relax\relax}
\newcommand\SB@gettabargs[7]{}
\def\SB@gettabargs#1#2#3#4#5#6#7\SB@gettabargs{%
  \SB@taberrorfalse%
  \SB@tabargs{}%
  \SB@gettabarg{#1}%
  \SB@gettabarg{#2}%
  \SB@gettabarg{#3}%
  \SB@gettabarg{#4}%
  \SB@gettabarg{#5}%
  \SB@gettabarg{#6}%
  \renewcommand\SB@tabexcess{#7}%
  \ifx\SB@tabexcess\SB@tabtail\else%
    \SB@taberrortrue%
  \fi%
  \ifSB@taberror%
    \SB@Error{Invalid argument to \protect\tablature\space macro.}%
    {Valid arguments consist of exactly six of the following:\space%
     X, O, 0, 1, 2, 3, or 4.}%
    \SB@tabargs{\0\0\0\0\0\0}%
  \fi%
}
\newcommand\SB@gettabarg[1]{%
  \ifx X#1\SB@tabargs\expandafter{\the\SB@tabargs\X}\else%
  \ifx O#1\SB@tabargs\expandafter{\the\SB@tabargs\0}\else%
  \ifx0#1\SB@tabargs\expandafter{\the\SB@tabargs\0}\else%
  \ifx1#1\SB@tabargs\expandafter{\the\SB@tabargs\1}\else%
  \ifx2#1\SB@tabargs\expandafter{\the\SB@tabargs\2}\else%
  \ifx3#1\SB@tabargs\expandafter{\the\SB@tabargs\3}\else%
  \ifx4#1\SB@tabargs\expandafter{\the\SB@tabargs\4}\else%
    \SB@taberrortrue%
  \fi\fi\fi\fi\fi\fi\fi%
}
\newcommand\SB@tablature[4]{%
  \endgroup%
  \ifvmode\leavevmode\fi%
  \vbox{%
    \normalfont\normalsize%
    \setbox\SB@box\hbox{\thinspace{\printchord{#1\strut}}\thinspace}%
    \setbox\SB@boxii\hbox{\SB@fretnum{#2}}%
    \hsize\wd\SB@box%
    \SB@tdwidth\wd\SB@boxii%
    \ifSB@gettabind%
      \SB@tabindent\SB@tdwidth%
      \advance\SB@tabindent0.5\SB@fretwidth%
      \global\advance\SB@tabindent-0.5pt%
    \fi%
    \advance\SB@tdwidth6\SB@fretwidth%
    \ifdim\hsize<\SB@tdwidth%
      \hsize\SB@tdwidth%
    \else\ifSB@gettabind%
      \SB@dimen\hsize%
      \advance\SB@dimen-\SB@tdwidth%
      \divide\SB@dimen\tw@%
      \global\advance\SB@tabindent\SB@dimen%
    \fi\fi%
    \global\SB@gettabindfalse%
    \hbox to\hsize{\hfil\unhbox\SB@box\hfil}%
    \kern-2pt%
    \hbox to\hsize{%
      \hfil%
      \vbox{\box\SB@boxii\kern18pt}%
      \vbox{%
        \SB@gettabargs%
        #3\relax\relax\relax\relax\relax\relax%
        \SB@gettabargs%
        \def\X{\SB@topfret{%
          \hbox{\kern-0.2pt%
            \fontencoding{OMS}\fontfamily{cmsy}%
            \fontseries{m}\fontshape{n}%
            \fontsize{7}{7}\selectfont\char2%
          \kern-0.2pt}%
        }}%
        \def\0{\SB@topfret{%
          \lower0.74pt\hbox{%
            \fontencoding{OMS}\fontfamily{cmsy}%
            \fontseries{m}\fontshape{n}%
            \fontsize{10}{10}\selectfont\char14%
          }%
        }}%
        \let\1\SB@topempty\let\2\SB@topempty%
        \let\3\SB@topempty\let\4\SB@topempty%
        \hbox to6\SB@fretwidth{\the\SB@tabargs}%
        \nointerlineskip%
        \let\X\SB@fretopen\let\0\SB@fretopen%
        \let\1\SB@frethit \let\2\SB@fretopen%
        \let\3\SB@fretopen\let\4\SB@fretopen%
        \SB@fretbar\hbox{\the\SB@tabargs}%
        \let\1\SB@fretopen\let\2\SB@frethit%
        \SB@fretbar\hbox{\the\SB@tabargs}%
        \let\2\SB@fretopen\let\3\SB@frethit%
        \SB@fretbar\hbox{\the\SB@tabargs}%
        \let\3\SB@fretopen\let\4\SB@frethit%
        \SB@fretbar\hbox{\the\SB@tabargs}%
        \SB@fretbar%
        \let\X\SB@topempty\let\0\SB@topempty%
        \def\1{\SB@topfret{\sffamily\fontsize{6}{6}\selectfont1}}%
        \def\2{\SB@topfret{\sffamily\fontsize{6}{6}\selectfont2}}%
        \def\3{\SB@topfret{\sffamily\fontsize{6}{6}\selectfont3}}%
        \def\4{\SB@topfret{\sffamily\fontsize{6}{6}\selectfont4}}%
        \def\SB@temp{#4}%
        \ifx\SB@temp\@empty\else%
          \SB@gettabargs%
          #4\relax\relax\relax\relax\relax\relax%
          \SB@gettabargs%
          \kern1.5pt%
          \hbox to6\SB@fretwidth{\the\SB@tabargs}%
        \fi%
      }%
      \hfil%
    }%
    \kern3pt%
  }%
}
\newcommand\tablature{}
{
  \catcode`#\active
  \catcode`&\active
  \gdef\tablature{%
    \begingroup%
    \catcode`#\active\catcode`&\active%
    \let#\shrp\let&\flt%
    \SB@tablature%
  }
}
\newcommand\songchapter{%
  \let\SB@temp\@seccntformat%
  \def\@seccntformat##1{}%
  \@startsection{chapter}{0}{\z@}%
    {3.5ex plus1ex minus.2ex}%
    {0.4ex\let\@seccntformat\SB@temp}%
    {\sffamily\bfseries\LARGE\centering}%
}
\newcommand\songsection{%
  \let\SB@temp\@seccntformat%
  \def\@seccntformat##1{}%
  \@startsection{section}{1}{\z@}%
    {3.5ex plus1ex minus.2ex}%
    {0.4ex\let\@seccntformat\SB@temp}%
    {\sffamily\bfseries\LARGE\centering}%
}
\newenvironment{songs}[1]{%
  \SB@ejectpage%
  \gdef\SB@indexlist{#1}%
  \stepcounter{SB@songsnum}%
  \setcounter{songnum}{1}%
  \SB@songsenvtrue%
}{%
  \SB@finalizesonglist%
  \SB@ejectpage%
  \clearpage%
  \thispagestyle{empty}%
  \cleardoublepage%
  \SB@songsenvfalse%
}
\newcounter{SB@songsnum}
\newcommand\SB@indexlist{}
\newcommand\SB@newindex[4]{%
  \ifSB@genindexes%
    \expandafter\newcommand\csname SB@idxfilename@#3\endcsname{#4}%
    \begingroup%
      \newwrite\SB@theindex%
      \immediate\openout\SB@theindex=#4.dat%
      \the#2%
      \global\expandafter\let\csname SB@index@#3\endcsname\SB@theindex%
    \endgroup%
    \expandafter\newcommand\csname SB@idxsel@#3\endcsname[3]{###1}%
  \fi%
}
\newcommand\newindex[2]{%
  \AtBeginDocument{\SB@newindex1\SB@titleinit{#1}{#2}}%
}
\@onlypreamble\newindex
\newtoks\SB@titleinit
\SB@titleinit{\immediate\write\SB@theindex{TITLE INDEX DATA FILE}}
\newcommand\newscripindex[2]{%
  \AtBeginDocument{\SB@newindex2\SB@scripinit{#1}{#2}}%
}
\@onlypreamble\newscripindex
\newtoks\SB@scripinit
\SB@scripinit{\immediate\write\SB@theindex{SCRIPTURE INDEX DATA FILE}}
\newcommand\newauthorindex[2]{%
  \AtBeginDocument{\SB@newindex3\SB@authinit{#1}{#2}}%
}
\@onlypreamble\newauthorindex
\newtoks\SB@authinit
\SB@authinit{\immediate\write\SB@theindex{AUTHOR INDEX DATA FILE}}
\newcommand\SB@percent{}
{\catcode`\%=12\gdef\SB@percent{%}}
\newcommand\SB@idxcmd[2]{%
  #1\expandafter{%
    \the#1%
    \immediate\write\SB@theindex{\SB@percent#2}%
  }%
}
\newcommand\authsepword[1]{\SB@idxcmd\SB@authinit{sep #1}}
\@onlypreamble\authsepword
\newcommand\authbyword[1]{\SB@idxcmd\SB@authinit{after #1}}
\@onlypreamble\authbyword
\newcommand\authignoreword[1]{\SB@idxcmd\SB@authinit{ignore #1}}
\@onlypreamble\authignoreword
\newcommand\titleprefixword[1]{\SB@idxcmd\SB@titleinit{prefix #1}}
\@onlypreamble\titleprefixword
\newcommand\SB@addtoindex[2]{%
  \ifSB@genindexes%
    \immediate\write#1{#2}%
    \immediate\write#1{\songnumstyle{songnum}}%
    \immediate\write#1{%
      song\arabic{SB@songsnum}-\songnumstyle{songnum}.%
      \ifnum\arabic{section}=0 1\else2\fi}%
  \fi%
}
\newcommand\SB@addtoindexes[3]{%
  \@for\SB@temp:=\SB@indexlist\do{%
    \SB@addtoindex{\csname SB@index@\SB@temp\endcsname}%
      {\csname SB@idxsel@\SB@temp\endcsname{\the#1}{\the#2}{\the#3}}%
  }%
}
\newcommand\SB@addtotitles[1]{%
  \@for\SB@temp:=\SB@indexlist\do{%
    \csname SB@idxsel@\SB@temp\endcsname{%
      \SB@addtoindex{\csname SB@index@\SB@temp\endcsname}{\the#1}%
    }{}{}%
  }%
}
\newcommand\indexentry[1]{%
  \SB@toks{*#1}%
  \SB@addtotitles\SB@toks%
}
\newcommand\indextitleentry[1]{%
  \SB@toks{#1}%
  \SB@addtotitles\SB@toks%
}
\newbox\SB@idxbox
\newbox\SB@idxtitlebox
\newdimen\SB@idxboxheight
\newskip\SB@idxlineskip
\SB@idxlineskip\p@\@plus\p@\@minus\p@
\newcommand\SB@makeidxentry[1]{{%
  \hbadness\@M\hfuzz\maxdimen%
  \SB@dimen\hsize%
  \advance\SB@dimen-#1\relax%
  \SB@dimenii\SB@dimen%
  \advance\SB@dimenii-\wd\SB@BRboxL%
  \interlinepenalty\@M%
  \parshape\tw@\z@\hsize\SB@dimen#1\relax%
  \noindent\unhcopy\SB@BRboxL%
  \leaders\hbox to0.5em{\hss.\hss}\hskip\SB@dimenii\@plus1fil%
  \unhcopy\SB@BRboxR%
  \par%
}}%
\newdimen\SB@BRmininc\SB@BRmininc2pt
\newdimen\SB@BRinc
\newdimen\SB@BRmaxheight
\newdimen\SB@bestwidth
\newdimen\SB@BRtestwidth
\newbox\SB@BRboxL
\newbox\SB@BRboxR
\newcommand\SB@balancerows{%
  \SB@bestwidth\hsize%
  \advance\SB@bestwidth-\wd\SB@BRboxL%
  \advance\SB@bestwidth-2em%
  \setbox\SB@box\vbox{%
    \SB@makeidxentry\SB@bestwidth%
  }%
  \SB@BRmaxheight\ht\SB@box%
  \SB@BRtestwidth0.5\SB@bestwidth%
  \SB@BRinc\SB@BRtestwidth%
  \loop%
    \SB@BRinc0.5\SB@BRinc%
    \setbox\SB@box\vbox{%
      \SB@makeidxentry\SB@BRtestwidth%
    }%
    \ifdim\ht\SB@box>\SB@BRmaxheight%
      \advance\SB@BRtestwidth\SB@BRinc%
    \else%
      \SB@bestwidth\SB@BRtestwidth%
      \advance\SB@BRtestwidth-\SB@BRinc%
    \fi%
  \ifdim\SB@BRinc>\SB@BRmininc\repeat%
  \SB@makeidxentry\SB@bestwidth%
}
\newcommand\SB@ellipspread[2]{%
  \setbox\SB@BRboxL\hbox{#1}%
  \setbox\SB@BRboxR\hbox{#2}%
  \SB@bestwidth\wd\SB@BRboxL%
  \advance\SB@bestwidth2em%
  \advance\SB@bestwidth\wd\SB@BRboxR%
  \ifdim\SB@bestwidth>\hsize%
    \SB@balancerows%
  \else%
    \hbox to\hsize{%
      \unhbox\SB@BRboxL%
      \leaders\hbox to0.5em{\hss.\hss}\hfil%
      \unhbox\SB@BRboxR%
    }\par%
  \fi%
}
\newcommand\SB@idxitemsep{%
  ,\penalty0\hskip.33em\@minus.11em\hfilneg\vadjust{}\hfil%
}
\newenvironment{idxblock}[1]{}{}
\newcommand\idxentry[2]{}
\newcommand\idxaltentry[2]{}
\newenvironment{SB@largeidxblock}[1]{}{}
\newenvironment{SB@smallidxblock}[1]{}{}
\newcommand\SB@makeidxcolumn{%
  \ifdim\ht\SB@idxbox=\z@%
    \hskip\hsize\relax%
  \else%
    \splittopskip\z@skip\splitmaxdepth3pt%
    \vsplit\SB@idxbox to\SB@idxboxheight%
    \global\setbox\SB@idxbox\vbox{%
      \hbox{\splitbotmark}%
      \unvbox\SB@idxbox%
    }%
  \fi%
}
\newcommand\SB@oneidxpage{}
\newcommand\SB@displayindex[3]{%
  \ifSB@showindexes\begingroup%
    \setbox\SB@idxtitlebox\vbox{%
      \@ifundefined{chapter}\songsection\songchapter{#1}%
    }%
    \IfFileExists{\csname SB@idxfilename@#2\endcsname.tex}{%
      \@ifundefined{hyperlink}{\let\hyperlink\@secondoftwo}{}%
      \setbox\SB@idxbox\vbox{%
        \unvcopy\SB@idxtitlebox%
        \vskip0.5in\relax%
        \hbox to\hsize{%
          \hfil%
          \vbox{%
            \hsize\SB@colwidth%
            \renewenvironment{idxblock}[1]%
              {\begin{SB@smallidxblock}{####1}}%
              {\end{SB@smallidxblock}}%
            \let\\\SB@idxitemsep%
            \input{\csname SB@idxfilename@#2\endcsname.tex}%
          }%
          \hfil%
        }%
      }%
      \ifdim\ht\SB@idxbox>\textheight%
        \setbox\SB@idxbox\vbox{%
          \renewenvironment{idxblock}[1]%
            {\begin{SB@largeidxblock}{####1}}%
            {\end{SB@largeidxblock}}%
          \let\\\SB@idxitemsep%
          \hsize\textwidth%
          \parskip\z@skip\parfillskip\z@skip%
          \baselineskip11pt\relax%
          \lineskiplimit\z@\lineskip\p@\relax%
          \ifSB@singlecol\else%
            \advance\hsize\columnsep%
            \advance\hsize-#3\columnsep%
            \divide\hsize#3\relax%
          \fi%
          \input{\csname SB@idxfilename@#2\endcsname.tex}%
          \vfil%
        }%
        \SB@toks{\SB@makeidxcolumn}%
        \ifSB@singlecol\else%
          \SB@cnt#3\relax%
          \loop\ifnum\SB@cnt>\@ne%
            \SB@toks\expandafter{\the\SB@toks%
              \kern\columnsep\SB@makeidxcolumn}%
            \advance\SB@cnt-\@ne%
          \repeat%
        \fi%
        \edef\SB@oneidxpage{\the\SB@toks}%
        \unvbox\SB@idxtitlebox%
        \vskip1em\relax%
        \nointerlineskip%
        \null%
        \nointerlineskip%
        \loop%
          \SB@idxboxheight\textheight%
          \advance\SB@idxboxheight-\pagetotal%
          \hbox{\SB@oneidxpage}%
          \vfil\break%
        \ifdim\ht\SB@idxbox>\z@\repeat%
      \else%
        \null%
        \vfil%
        \unvbox\SB@idxbox%
        \vskip\z@\@plus2fil\relax%
      \fi%
    }{%
      \vbox to\textheight{%
        \vfil%
        \unvbox\SB@idxtitlebox%
        \vskip1em\relax%
        \hbox to\textwidth{\hfil[Index not yet generated.]\hfil}%
        \vskip\z@\@plus2fil\relax%
      }%
    }%
    \cleardoublepage%
  \endgroup\fi%
}
\newcommand\showindex[2]{%
  \csname SB@idxsel@#2\endcsname%
  \SB@makesongindex\SB@makescripindex\SB@makeauthorindex%
  {#1}{#2}%
}
\newcommand\SB@makesongindex[2]{%
  \renewenvironment{SB@largeidxblock}[1]{
    \parindent\z@%
    \hbox{\SB@colorbox{\vbox{%
      \hbox to\idxheadwidth{\sffamily\bfseries\LARGE##1\hfil}%
    }}}%
    \nobreak\vskip3pt\@plus2pt\@minus2pt\vskip-\SB@idxlineskip%
  }{\penalty-50 \vskip5pt\@plus5pt\@minus4pt}%
  \renewenvironment{SB@smallidxblock}[1]%
    {\vskip-\SB@idxlineskip}%
    {\vskip\SB@idxlineskip}%
  \renewcommand\idxentry[2]{%
    \vskip\SB@idxlineskip%
    \SB@ellipspread{\sffamily\slshape\ignorespaces##1\unskip}{##2}%
  }%
  \renewcommand\idxaltentry[2]{%
    \vskip\SB@idxlineskip%
    \SB@ellipspread{\rmfamily\ignorespaces##1\unskip}{##2}%
  }%
  \SB@displayindex{#1}{#2}{2}%
}
\newtoks\SB@idxcolhead
\newcommand\idxcont[1]{#1 {\mdseries(continued)}}
\newcommand\SB@makescripindex[2]{%
  \renewenvironment{SB@largeidxblock}[1]{%
    \global\SB@idxcolhead{##1}%
    \noindent\hbox to\hsize{\small\bfseries##1\hfil}\par%
    \nobreak%
  }{%
    \nobreak\mark{\noexpand\relax}%
    \penalty-20\vskip3pt\@plus3pt\relax%
  }%
  \renewenvironment{SB@smallidxblock}[1]{%
    \begin{SB@largeidxblock}{##1}%
  }{%
    \end{SB@largeidxblock}%
  }%
  \renewcommand\idxentry[2]{%
    \vskip\z@\@plus2pt\@minus\p@%
    \mark{\noexpand\noindent%
      {\noexpand\small\noexpand\bfseries%
       \noexpand\idxcont{\the\SB@idxcolhead}}%
    }%
    \nobreak%
    \parindent0.25cm%
    \SB@ellipspread{\sffamily\small\slshape\indent##1}{##2}%
  }%
  \renewcommand\idxaltentry[2]{%
    \SB@Error%
    {\protect\idxaltentry\space not allowed in a scripture index}%
    {This error should not occur. The index generation routines\space%
    have malfunctioned. Try deleting all temporary files and\space%
    then recompiling.}%
  }%
  \SB@displayindex{#1}{#2}{3}%
}
\newcommand\SB@makeauthorindex[2]{%
  \renewenvironment{SB@largeidxblock}[1]{\parindent\z@}{}%
  \renewenvironment{SB@smallidxblock}[1]{\parindent\z@}{}%
  \renewcommand\idxentry[2]{%
    \SB@ellipspread{\small\bfseries\sfcode`.\@m##1}{##2}%
    \vskip\SB@idxlineskip%
  }%
  \renewcommand\idxaltentry[2]{%
    \SB@Error%
    {\protect\idxaltentry\space not allowed in an author index}%
    {This error should not occur. The index generation routines\space%
    have malfunctioned. Try deleting all temporary files and\space%
    then recompiling.}%
  }%
  \SB@displayindex{#1}{#2}{2}%
}
\ifrawtext
  \newwrite\SB@txtout
  \immediate\openout\SB@txtout=\jobname.txt
  \newif\ifSB@doEOL
  {\catcode`\^^M12 %
   \catcode`\^^J12 %
   \gdef\SB@printEOL{\ifSB@doEOL^^M^^J\fi}}
  {\catcode`#12\gdef\SB@hash{#}}
  {\catcode`&12\gdef\SB@amp{&}}
  \def\beginsong#1{\SB@beginsong{#1}}
  \def\SB@@@beginsong{%
    \begingroup%
      \def\'{}\def\`{}\def\v{}\def\u{}\def\={}\def\^{}%
      \def\.{}\def\H{}\def\~{}\def\"{}\def\t{}%
      \def\copyright{(c)}%
      \let~\space%
      \let\par\SB@printEOL%
      \let\#\SB@hash%
      \let\&\SB@amp%
      \catcode`|9 %
      \catcode`*9 %
      \catcode`^9 %
      \def\[##1]{}%
      \resettitles%
      \immediate\write\SB@txtout{\songnumstyle{songnum}. \songtitle}%
      \nexttitle%
      \foreachtitle{\immediate\write\SB@txtout{(\songtitle)}}%
      \ifx\songauthors\@empty\else%
         \immediate\write\SB@txtout{\songauthors}%
      \fi%
      \ifx\songrefs\@empty\else%
         \immediate\write\SB@txtout{\songrefs}%
      \fi%
      \immediate\write\SB@txtout{}%
      \SB@doEOLfalse%
      \obeylines%
  }
  \def\endsong{%
      \SB@doEOLtrue%
      \immediate\write\SB@txtout{\songcopyright\space%
        \songlicense\SB@printEOL}%
    \endgroup%
    \SB@insongfalse%
    \stepcounter{songnum}%
  }
  \def\SB@parsesrefs#1{#1}
  \long\def\beginverse#1#2\endverse{%
    \SB@doEOLtrue\begingroup%
      \def\textnote##1{##1}%
      \def\SB@temp{#1}%
      \def\SB@star{*}%
      \ifx\SB@temp\SB@star%
        \immediate\write\SB@txtout{\@gobble#2}%
      \else%
        \immediate\write\SB@txtout{#2}%
      \fi%
    \endgroup\SB@doEOLfalse}
  \long\def\beginchorus#1\endchorus{%
    \SB@doEOLtrue\begingroup%
      \def\textnote##1{##1}%
      \immediate\write\SB@txtout{Chorus:#1}%
    \endgroup\SB@doEOLfalse}
  \long\def\beginchordedonly#1\endchordedonly{}
  \long\def\beginlyriconly#1\endlyriconly{#1}
  \long\def\beginscripture#1\endscripture{}
  \def\musicnote#1{}
  \def\textnote#1{%
    \SB@doEOLtrue%
    \immediate\write\SB@txtout{#1\SB@printEOL}%
    \SB@doEOLfalse}
  \renewcommand\brk{}
  \def\rep#1{(x#1)}
  \def\echo#1{(#1)}
  \def\meter#1#2{}
  \def\mbar#1#2{}
  \def\transpose#1{}
  \def\capo#1{}
  \def\prefersharps{}
  \def\preferflats{}
\else
\newcommand\beginsong{}
\let\beginsong\SB@beginsong
\let\endsong\SB@endsong
\newcommand\beginverse{}
\let\beginverse\SB@beginverse
\let\endverse\SB@endverse
\newcommand\beginchorus{}
\let\beginchorus\SB@beginchorus
\let\endchorus\SB@endchorus
\newcommand\beginchordedonly{}
\let\beginchordedonly\SB@beginchordedonly
\let\endchordedonly\SB@endchordedonly
\newcommand\beginlyriconly{}
\let\beginlyriconly\SB@beginlyriconly
\let\endlyriconly\SB@endlyriconly
\newcommand\beginscripture{}
\let\beginscripture\SB@beginscripture
\let\endscripture\SB@endscripture
\newcommand\Acolon{}
\let\Acolon\SB@Acolon
\newcommand\Bcolon{}
\let\Bcolon\SB@Bcolon
\newcommand\strophe{}
\let\strophe\SB@strophe
\newcommand\scripindent{}
\let\scripindent\SB@scripindent
\newcommand\scripoutdent{}
\let\scripoutdent\SB@scripoutdent
\newcommand\musicnote{}
\let\musicnote\SB@musicnote
\newcommand\textnote{}
\let\textnote\SB@textnote
\newcommand\meter{}
\let\meter\SB@meter
\newcommand\mbar{}
\let\mbar\SB@mbar
\newcommand\transpose{}
\let\transpose\SB@transpose
\newcommand\capo{}
\let\capo\SB@capo
\newcommand\prefersharps{}
\let\prefersharps\SB@prefshrps
\newcommand\preferflats{}
\let\preferflats\SB@prefflts
\fi
\newcommand\SB@outerpar{}
\SB@outer\def\SB@outerpar{\par}
\endinput
%%
%% End of file `songs.sty'.
